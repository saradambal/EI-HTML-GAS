<!--//*******************************************FILE DESCRIPTION*********************************************//
/*********************************BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE*******************************/
//DONE BY:PUNI
//VER 1.9-SD:09/10/2014 ED:09/10/2014,TRACKER NO:511,corrected script for preloader,msgbox position
//DONE BY:SARADAMBAL
//VER 1.8-SD:15/09/2014 ED:15/09/2014,TRACKER NO:511,implemented script for preloader,msgbox
//VER 1.7-SD:28/08/2014 ED:28/08/2014,TRACKER NO:511,updated data table version 1.10.2
//VER 1.6-SD:13/08/2014 ED:13/08/2014,TRACKER NO:511,implemented script for reset normal size after updation,updated new links,checked autocommit  
//VER 1.5-SD:27/07/2014 ED:27/07/2014,TRACKER NO:511,implemented script for starhub DP validation, autocomplete for unit category
//VER 1.4-SD:21/07/2014 ED:21/07/2014,TRACKER NO:511,implemented coding to sort asc,desc for inv date,from period,to period, timestamp and forperiod- DONE BY SARADAMBAL
//VER 1.3-SD:11/07/2014 ED:12/07/2014,TRACKER NO:511,implemented sp to get inv,sdate & edate for dynamic dp validation using eilib,removed script for dynamic dp validation- DONE BY SARADAMBAL
//VER 1.2-SD:25/06/2014 ED:25/06/2014,TRACKER NO:511,implemented err msg if the record not having within unit validation period,corrected some err msg
//VER 1.1-SD:19/06/2014 ED:19/06/2014,TRACKER NO:511,removed alais(as) for inv date,from period and to period for temp table(electricity)
//VER 1.0-SD:17/06/2014 ED:18/06/2014,TRACKER NO:511,implemented failure function,commit function,add class for amt (add title numbers only),checked tickler for updation and deletion,updated link for show entries
//VER 0.09-SD:05/06/2014 ED:06/06/2014,TRACKER NO:511,updated link,put 100 record in datatable
//VER 0.08-SD:24/05/2014 ED:26/05/2014,TRACKER NO:511,cheked in integration site,removed sno in data table
//VER 0.07-SD:14/05/2014 ED:16/05/2014,TRACKER NO:511,hide preloader if no card details in PAC,checked all srch option(initializing data),tickler,changed 3 digit  for all invoice amount in biz daily types except unit invoice amt(5 digit)--SARADAMBAL
//VER 0.06-SD:07/05/2014 ED:07/05/2014,TRACKER NO:511,put success function in seperate,implemented dynamic temp for electricity type search
//VER 0.05-SD:21/04/2014 ED:21/04/2014,TRACKER NO:511,changed sp name for unit deletion,to show err msg if no customer in unit in datatable update form-SARADAMBAL
//VER 0.04-SD:16/04/2014 ED:16/04/2014,TRACKER NO:511,checked migration data and after lp changes,corrected and replaced error msg for description,implemented script for dp validation,implemented script for update validation,hide preloader while getting migration type in unit expense-SARADAMBAL
//DONE BY:PRADAP,PUNITHA
//VER 0.03-SD:29/03/2014 ED:04/04/2014,TRACKER NO:511,corrected srchbtn validation,error msg(no table entry),sp(unit expense),dp(invoice,forperiod)
//VER 0.02-SD:22/01/2014 ED:15/03/2014,TRACKER NO:511,corrected all select query,fileterd active unit condition in all search n updated validation,err msgs by PUNI
//VER 0.01-INITIAL VERSION, SD:3/11/2013 ED:29/11/2013,TRACKER NO:511 by PRADAP.
//*********************************************************************************************************-->
<html>
<head>
<!----------------------------COMMON JQUERY LINKS START---------------------------->
<!--TO SUPPORT JQUERY FUNCTIONALITIES-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<!--TO SUPPORT JQUERY UI FUNCTIONALITIES-->
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>
<!--TO SUPPORT OLD FUNCTIONALITIES-->
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<!--TO SUPPORT DATE PICKER CSS-->
<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/themes/smoothness/jquery-ui.css" />
<!----------------------------COMMON JQUERY LINKS END---------------------------->
<!----------------------------CUSTOMIZED JQUERY LINKS START---------------------------->
<!--TO SUPPORT JQUERY LIB VALIDATION-->
<script src="https://googledrive.com/host/0B5pkfK_IBDxjU1FrR3hVTXB4a28/JQuery.js"></script>
<!--TO SUPPORT FORM CSS-->
<link rel="stylesheet" href="https://googledrive.com/host/0B5pkfK_IBDxjU1FrR3hVTXB4a28/StyleSheet.css">
<!----------------------------CUSTOMIZED JQUERY LINKS END---------------------------->
<!--TO SUPPORT DATATABLE FUNCTIONALITIES-->
<script src="https://googledrive.com/host/0B5pkfK_IBDxjU1FrR3hVTXB4a28/DataTable1.10.2.js"></script> 
<script src="http://jquery-datatables-editable.googlecode.com/svn/trunk/media/js/jquery.dataTables.min.js"></script>
<script>
//CHECK PRELOADER STATUS N HIDE START
var SubPage=1;
function CheckPageStatus(){
if(MenuPage!=1 && SubPage!=1)
$(".preloader").fadeOut(500);
}
//FUNCTION TO ALERT EXCEPTION ERROR
function onFailure(BDLY_SRC_error) {
$(".preloader").fadeOut(500);
if(BDLY_SRC_error=="ScriptError: Failed to establish a database connection. Check connection string, username and password.")
{
var BDLY_SRC_position=$("#DDC_lb_unitselect").position();
BDLY_SRC_error="DB USERNAME/PWD WRONG, PLZ CHK UR CONFIG FILE FOR THE CREDENTIALS."
$('#BDLY_SRC_form').replaceWith('<center><label class="dberrormsg">'+BDLY_SRC_error+'</label></center>');
}
else
{
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_error,position:{top:400,left:550}}}); 
}}
//ERROR MESSAGE CODES
var BDLY_SRC_errormessagecodes={126:[115,109],125:[119,113,406],124:[220,221,404],131:[115,109],191:[18,22,407,8,10],197:[312,313],
132:[116,110,45],127:[226,227,405],128:[119,113,406],129:[123,122],130:[125,124],151:[184,186,408],
152:[116,110,45],153:[119,113,406],154:[182,183,409],155:[123,122],156:[115,109],157:[180,181,410],
158:[125,124],159:[119,113,406],162:[123,122],164:[115,109],165:[179,181,410],166:[125,124],
160:[144,148,45],161:[144,148,45],163:[144,148,45],185:[119,113,406],186:[114,108,411],188:[115,109],
187:[116,110,45],189:[117,111,406],190:[118,112,406],178:[185,186,408],179:[119,113,406],180:[123,122],184:[125,124],181:[116,110,45],
182:[115,109],183:[178,181,410],175:[119,113,406,8,10],177:[115,109,0,8,10],174:[51,50,412,8,10],
176:[116,110,45,8,10],137:[144,148,45],138:[144,148,45],
136:[115,109],140:[119,113,406],139:[117,111,406],
171:[119,113,406],173:[115,109],172:[144,148,45],
146:[119,113,406],147:[415,134],148:[144,148,45],149:[130,134],150:[18,22,407,8,10],198:[414,7,9],
167:[119,113,406],170:[115,109],168:[144,148,45],169:[144,148,45],
141:[419,424,422,245,246,445],142:[421,425,422,245,246,445],143:[418,423,406,245,246,445],145:[416,417,0,245,246,445],144:[420,134,0,245,246,445]
};
//DECLARATION OF GLOBAL VARIABLES
var BDLY_SRC_sucsval=0;
var CurrentElem='null',
BDLY_SRC_CurrentTR=null,
Unit_Exp_Category=null,
BDLY_SRC_DeleteKey=null,
startdate=null,enddate=null,
Unit_Exp_Cusname_global=null,
unit_start_end_date_obj=null,
BDLY_DT_currentunit=null,
BDLY_DT_unitno_toload_name=null,
BDLY_DT_row_new_vals=null,
BDLY_DT_row_old_vals=null,
BDLY_SRC_unit_custname=null,
BDLY_SCR_DT_currentfield_access_card=null,
BDLY_SCR_DT_currentfield_hkp_unitno=null,BDLY_SCR_monthBefore=null,BDLY_SCR_yearBefore=null,
ErrorControl ={AmountCompare:'InValid'},
BDLY_SRC_unitcategoryvalue=[],
BDLY_SRC_HKunitnovalues=[],
BDLY_SRC_errormsglist=[],
BDLY_SRC_arr_chkexp=[],
BDLY_SRC_errormessagewitdata,
BDLY_SRC_errormessagenodata,
BDLY_SRC_finalerrr=[],
BDLY_SRC_finalerrrcodes,
BDLY_SRC_btn_dbvalues=true,
BDLY_SRC_purchasecard=1,
BDLY_SRC_unitenddate=null,
BDLY_SRC_unitstartdate=null,
BDLY_SRC_unitinvdate=null,
BDLY_DT_flg_date=1,
BDLY_SRC_confirmmessages=[],
BDLY_SRC_arr_unitcmts=[];
var BDLY_SRC_flag_autocom='';
// This function will run when the page is loaded.
$(document).ready(function() {
$(".preloader").show();
$('textarea').autogrow({onInitialize: true});
var seclectFormtype;
//CALL GS FUNCTION TO GET EXPENSE LIST,UNIT EXP CATEGORY,ERR MESSAGES
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_result_getInitialvalue).BDLY_SRC_getInitialvalue();
//FUNCTION TO SET RESULT OF EXPENSE LIST,UNIT EXP CATEGORY,ERR MESSAGES
function BDLY_SRC_result_getInitialvalue(initialvalue) {
var ExpenseList=[];
BDLY_SRC_errormsglist=initialvalue.errormsg;
ExpenseList=initialvalue.explist;
BDLY_SRC_unitcategoryvalue=initialvalue.unitcat;
BDLY_SRC_arr_chkexp=initialvalue.BIZDLY_SRC_chk_exptble;
var confirmmessagescodes=[106,107,170,401,315,2,462,204,205,206,207,208,426,427,428,429,430,431,432,433,434,435,436,437,438,439,413];
//GET CONFIRMATION MESSAGES
BDLY_SRC_confirmmessages=BDLY_SRC_getAllErrorMessages(confirmmessagescodes)
var BDLY_SRC_flg_chkExpTble=0;
for (var j = 0; j < initialvalue.BIZDLY_SRC_chk_exptble.length; j++) 
{
if(initialvalue.BIZDLY_SRC_chk_exptble[j]==0)
BDLY_SRC_flg_chkExpTble=BDLY_SRC_flg_chkExpTble+1;
else
BDLY_SRC_flg_chkExpTble=BDLY_SRC_flg_chkExpTble;
}
if(BDLY_SRC_flg_chkExpTble==16){
var BDLY_SRC_append_errmsg='<p><label class="errormsg">';
for (var j = 7; j < BDLY_SRC_confirmmessages.length-2; j++) 
{
BDLY_SRC_append_errmsg +=BDLY_SRC_confirmmessages[j]+'<br>'
}
BDLY_SRC_append_errmsg +='</label></p>'
$('#BDLY_SRC_form').replaceWith(BDLY_SRC_append_errmsg)
}
else{
var options;
for (var i = 0; i < ExpenseList.length; i++) 
{
options +='<option value="'+ExpenseList[i].key +'">' + ExpenseList[i].value + '</option>';
}
$('#BDLY_SRC_lb_ExpenseList').append(options);
}
//TO HIDE PRELOADER START
SubPage=0;
CheckPageStatus();
}
/*------------------------------------------TO GET SEARCH OPTION LIST FOR SELECTED EXPENSE----------------------------------------------------*/
$("#BDLY_SRC_lb_ExpenseList").change(function(){
$("#BDLY_SRC_div_searchresult,#BDLY_SRC_dynamicarea,#BDLY_SRC_Optionhead,#BDLY_SRC_div_searchresult_head,#BDLY_SRC_nodyndataerr").html('');
$('#BDLY_SRC_btn_search').hide();
$("#BDLY_SRC_lbl_errmsg_exp").text('')
$("#BDLY_SRC_tr_serachopt").hide();
var selectedexpense = $(this).val();
//CHECK EACH TABLE OF EXPENSE
var BDLY_SRC_twodim_chktble={
9:[BDLY_SRC_arr_chkexp[0],BDLY_SRC_confirmmessages[12],BDLY_SRC_arr_chkexp[1],BDLY_SRC_confirmmessages[11]],
8:[BDLY_SRC_arr_chkexp[2],BDLY_SRC_confirmmessages[13],BDLY_SRC_arr_chkexp[3],BDLY_SRC_confirmmessages[9]],
5:[BDLY_SRC_arr_chkexp[4],BDLY_SRC_confirmmessages[14],BDLY_SRC_arr_chkexp[5],BDLY_SRC_confirmmessages[10]],
1:[BDLY_SRC_arr_chkexp[8],BDLY_SRC_confirmmessages[15],BDLY_SRC_arr_chkexp[9],BDLY_SRC_confirmmessages[8]],
4:[BDLY_SRC_arr_chkexp[11],BDLY_SRC_confirmmessages[16],1,1],11:[BDLY_SRC_arr_chkexp[15],BDLY_SRC_confirmmessages[17],1,1],
12:[BDLY_SRC_arr_chkexp[16],BDLY_SRC_confirmmessages[18],1,1],7:[BDLY_SRC_arr_chkexp[12],BDLY_SRC_confirmmessages[20],1,1],
10:[BDLY_SRC_arr_chkexp[14],BDLY_SRC_confirmmessages[21],1,1],6:[BDLY_SRC_arr_chkexp[13],BDLY_SRC_confirmmessages[22],1,1],
2:[BDLY_SRC_arr_chkexp[6],BDLY_SRC_confirmmessages[23],BDLY_SRC_arr_chkexp[7],BDLY_SRC_confirmmessages[7]],3:[BDLY_SRC_arr_chkexp[10],BDLY_SRC_confirmmessages[24],1,1]};
if((BDLY_SRC_twodim_chktble[selectedexpense][0]==0)||(BDLY_SRC_twodim_chktble[selectedexpense][2]==0)){
if(BDLY_SRC_twodim_chktble[selectedexpense][0]==0)
$("#BDLY_SRC_lbl_errmsg_exp").html(BDLY_SRC_twodim_chktble[selectedexpense][1]+'<br>')
if(BDLY_SRC_twodim_chktble[selectedexpense][2]==0)
$("#BDLY_SRC_lbl_errmsg_exp").append(BDLY_SRC_twodim_chktble[selectedexpense][3])
$('#BDLY_SRC_tr_serachopt').hide();
}
else{
if(selectedexpense!=""){
$(".preloader").show();
var  newPos= adjustPosition($(this).position(),100,180);
resetPreloader(newPos);
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_LoadSearchOption).BDLY_SRC_getSearchOptions(selectedexpense);
}
$("#BDLY_SRC_div_searchresult").text("");
}});
/*-------------------------------------------SUCCESS FUNCTION SEARCH OPTION FOR SEARCH OPTION----------------*/
function BDLY_SRC_LoadSearchOption(Searchoptionhkpunit) {
$(".preloader").fadeOut(500);
var Searchoption_array=Searchoptionhkpunit.srcoption;
BDLY_SRC_HKunitnovalues=Searchoptionhkpunit.hkpunitno;
var totalsearchopt=Searchoption_array.length;
$("#BDLY_SRC_tr_serachopt").show();
$('#BDLY_SRC_lb_serachopt').html('');
var options='<option value="">SELECT</option>';
for (var i = 0; i <totalsearchopt; i++) {
options +='<option value="'+Searchoption_array[i].key +'">' + Searchoption_array[i].value + '</option>';
}
$('#BDLY_SRC_lb_serachopt').html(options);
}
//FUNCTION TO GET SEARCH OPTION FORM TYPE
function BDLY_SRC_getsearch_optiontype(selectedSearchopt)
{
var searchformtkeygroup = {127:'CAR NO',128:'COMMENTS',129:'FROM PERIOD',130:'TO PERIOD',131:'INVOICE DATE',132:'INVOICE AMOUNT',              //Car Park
159:'COMMENTS',160:'INVOICE AMOUNT',161:'INVOICE AMOUNT',162:'FROM PERIOD',163:'INVOICE AMOUNT',164:'INVOICE DATE',165:'INVOICE TO',166:'TO PERIOD',  //Electricity
167:'COMMENTS',168:'INVOICE AMOUNT',169:'INVOICE AMOUNT',170:'INVOICE DATE',
171:'COMMENTS',172:'INVOICE AMOUNT',173:'INVOICE DATE',136:'INVOICE DATE',137:'INVOICE AMOUNT',138:'INVOICE AMOUNT',139:'INVOICE ITEMS',140:'COMMENTS',
185:'COMMENTS',186:'CATEGORY',187:'INVOICE AMOUNT',188:'INVOICE DATE',189:'INVOICE ITEMS',190:'INVOICE FROM',191:'UNIT NO',                    //Unit Expense
174:'CARD NO',175:'COMMENTS',176:'INVOICE AMOUNT',177:'INVOICE DATE',                                                                          //purchase card
141:'CLEANER NAME',142:'FOR PERIOD DURATION',143:'COMMENTS',144:'DURATION',145:'INVOICE DATE',
146:'COMMENTS',147:'FOR PERIOD',148:'INVOICE AMOUNT',149:'INVOICE DATE',150:'UNIT NO',                                                // House keeping payment
151:'ACCOUNT NO',152:'INVOICE AMOUNT',153:'COMMENTS',154:'VOCIE NO',155:'INVOICE DATE',156:'INVOICE DATE',157:'INVOICE TO',158:'INVOICE DATE',
124:'SERVICED BY',125:'COMMENTS',126:'INVOICE DATE',197:'SERVICE DUE',
178:'ACCOUNT NO',179:'COMMENTS',180:'FROM PERIOD',181:'INVOICE AMOUNT',182:'INVOICE DATE',183:'INVOICE TO',184:'TO PERIOD'
};
return searchformtkeygroup[selectedSearchopt]
}
/*---------------------------------FUNCTION TO GET ERR MESSAGES-------------------------------------------*/
function BDLY_SRC_getAllErrorMessages(BDLY_SRC_finalerrrcodes)
{
BDLY_SRC_finalerrr=[];
for(var i=0;i<BDLY_SRC_finalerrrcodes.length;i++)
{
BDLY_SRC_finalerrr.push(BDLY_SRC_errormsglist.errormsg[BDLY_SRC_errormsglist.errorcode.indexOf(BDLY_SRC_finalerrrcodes[i].toString())])
}
return BDLY_SRC_finalerrr;
}
/*------------------------------------------TO GET EXPENSE DATA ON BASIS OF SELECTED SEARCH OPTION----------------------------------------------------*/
$("#BDLY_SRC_lb_serachopt").change(function(){
BDLY_SRC_btn_dbvalues=true;
BDLY_SRC_sucsval=0;
$('#BDLY_SRC_btn_search').attr("disabled", "disabled").hide();
$("#BDLY_SRC_div_searchresult_head,#BDLY_SRC_div_searchresult,#BDLY_SRC_dynamicarea,#BDLY_SRC_Optionhead,#BDLY_SRC_nodyndataerr").html('');
var selectedSearchopt = $(this).val(),selectedexpense=$('#BDLY_SRC_lb_ExpenseList').val();
$("#BDLY_SRC_Optionhead").text("");
//GET ERR MESSAGES BASED ON THE SEARCH OPTION START
BDLY_SRC_finalerrrcodes=BDLY_SRC_errormessagecodes[selectedSearchopt];
BDLY_SRC_getAllErrorMessages(BDLY_SRC_finalerrrcodes);
//GET ERR MESSAGES BASED ON THE SEARCH OPTION END
if(selectedSearchopt==198)
{
$(".preloader").show();
//var  newPos= adjustPosition($(this).position(),100,180);
//resetPreloader(newPos);
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_UpdateDataTable).BDLY_SRC_getAnyTypeExpData(document.getElementById('BDLY_SRC_form'));
}
else
{
if(selectedSearchopt!=""){
$("#BDLY_SRC_Optionhead").text($(this).find('option:selected').text());
seclectFormtype =BDLY_SRC_getsearch_optiontype(selectedSearchopt);//GET SEARCH OPTION FORM TYPE
//CREATE DYNAMIC SEARCH FORM ELEMENTS START
var TempInvoiceFromTR ='<tr id="BDLY_SRC_tr_searchopt_invoicefrom" class="BDLY_SRC_class_dynamicrows" ><td class="td_label">INVOICE FROM</td><td><input type="text" name="BDLY_SRC_invoicefrom" id="BDLY_SRC_invoicefrom" class="auto" disabled /></td></tr>';
var TempVoiceNoTR ='<tr id="BDLY_SRC_tr_searchopt_voiceno" class="BDLY_SRC_class_dynamicrows" ><td class="td_label">DIGITAL VOICE NO</td><td><input type="text" name="BDLY_SRC_voiceno" id="BDLY_SRC_voiceno" class="auto" disabled /></td></tr>';
var TempDurationFromTR ='<tr id="BDLY_SRC_tr_searchopt_durationfrom" class="BDLY_SRC_class_dynamicrows" ><td class="td_label">FROM DURATION</td><td><input type="text" name="BDLY_SRC_duration" id="BDLY_SRC_durationfrom" class="BDLY_SCR_Field duration"/></td></tr>';
var TempDurationToTR ='<tr id="BDLY_SRC_tr_searchopt_durationto" class="BDLY_SRC_class_dynamicrows" ><td class="td_label">TO DURATION</td><td><input type="text" name="BDLY_SRC_duration" id="BDLY_SRC_durationto" class="BDLY_SCR_Field duration"/></td><td><label id="BDLY_SCR_lbl_err_durationmin" class="errormsg"></label></td><td><label id="BDLY_SCR_lbl_err_durationhrs" class="errormsg"></label></td><td><label id="BDLY_SCR_lbl_err_duration" class="errormsg"></label></td></tr>';
var TempServiceDueTR ='<tr id="BDLY_SRC_tr_searchopt_servicedue"  ><td class="td_label">SERVICE DUE</td><td><input type="text" name="BDLY_SRC_servicedue" id="BDLY_SRC_servicedue" class="BDLY_SCR_Field BDLY_SCR_forperiod BDLT_SRC_Month_picker monthpicker datemandtry"/></td></tr>';
var TempCommentsTR ='<tr id="BDLY_SRC_tr_searchopt_comments" class="BDLY_SRC_class_dynamicrows" ><td class="td_label">COMMENTS</td><td><textarea name="BDLY_SRC_comments" id="BDLY_SRC_comments"  class="auto" disabled ></textarea></td></tr>';
var TempItemsTR ='<tr id="BDLY_SRC_tr_searchopt_invoiceitem" class="BDLY_SRC_class_dynamicrows" ><td class="td_label">INVOICE ITEMS</td><td><textarea name="BDLY_SRC_invoiceitem" id="BDLY_SRC_invoiceitem"  class="auto" disabled ></textarea></td></tr>';
var TempCategoryTR ='<tr id="BDLY_SRC_tr_searchopt_category" class="BDLY_SRC_class_dynamicrows" ><td class="td_label BDLY_SRC_class_lb_lbl">CATEGORY</td><td><select class="BDLY_SRC_class_Searchbtn_list_box BDLY_SCR_Field" name="BDLY_SRC_lb_category" id="BDLY_SRC_lb_category" ><option>SELECT</option></select></td></tr>'; 
var TempCusnameTR ='<tr style="display:none"id="BDLY_SRC_tr_searchopt_cusname"  ><td class="td_label BDLY_SRC_class_lb_lbl">CUSTOMER NAME</td><td><select class="BDLY_SRC_class_Searchbtn_list_box " name="BDLY_SRC_lb_cusname" id="BDLY_SRC_lb_cusname" ><option>SELECT</option></select></td></tr>'; 
var TempUnitTR ='<tr id="BDLY_SRC_tr_searchopt_unit" class="BDLY_SRC_class_dynamicrows" ><td class="td_label BDLY_SRC_class_lb_lbl">UNIT NO</td><td><select class="BDLY_SRC_class_Searchbtn_list_box BDLY_SCR_Field" name="BDLY_SRC_lb_unitno" id="BDLY_SRC_lb_unitno" ><option>SELECT</option></select></td></tr>'; 
var TempDigvoicenoTR ='<tr id="BDLY_SRC_tr_searchopt_Digvoiceno" class="BDLY_SRC_class_dynamicrows" ><td class="td_label BDLY_SRC_class_lb_lbl">DIGITAL VOICE NO</td><td><select class="BDLY_SRC_class_Searchbtn_list_box BDLY_SCR_Field" name="BDLY_SRC_lb_Digvoiceno" id="BDLY_SRC_lb_Digvoiceno" ><option>SELECT</option></select></td></tr>'; 
var TempCarNoTR ='<tr id="BDLY_SRC_tr_searchopt_carno" class="BDLY_SRC_class_dynamicrows" ><td class="td_label BDLY_SRC_class_lb_lbl">CAR NO</td><td><select class="BDLY_SRC_class_Searchbtn_list_box BDLY_SCR_Field" name="BDLY_SRC_lb_carno" id="BDLY_SRC_lb_carno" ><option>SELECT</option></select></td></tr>'; 
var TempCardNoTR ='<tr id="BDLY_SRC_tr_searchopt_cardno" class="BDLY_SRC_class_dynamicrows" ><td class="td_label BDLY_SRC_class_lb_lbl">CARD NO</td><td><select class="BDLY_SRC_class_Searchbtn_list_box BDLY_SCR_Field" name="BDLY_SRC_lb_cardno" id="BDLY_SRC_lb_cardno" ><option>SELECT</option></select></td></tr>'; 
var TempServiceByTR ='<tr id="BDLY_SRC_tr_searchopt_serviceby" class="BDLY_SRC_class_dynamicrows" ><td class="td_label BDLY_SRC_class_lb_lbl">AIRCON SERVICE BY</td><td><select class="BDLY_SRC_class_Searchbtn_list_box BDLY_SCR_Field" name="BDLY_SRC_lb_serviceby" id="BDLY_SRC_lb_serviceby" ><option>SELECT</option></select></td></tr>'; 
var TempInvoiceToTR ='<tr id="BDLY_SRC_tr_searchopt_invoiceto" class="BDLY_SRC_class_dynamicrows" ><td class="td_label BDLY_SRC_class_lb_lbl">INVOICE TO</td><td><select class="BDLY_SRC_class_Searchbtn_list_box BDLY_SCR_Field" name="BDLY_SRC_lb_invoiceto" id="BDLY_SRC_lb_invoiceto" ><option>SELECT</option></select></td></tr>'; 
var TempCleanerNameTR ='<tr id="BDLY_SRC_tr_searchopt_cleanername" class="BDLY_SRC_class_dynamicrows" ><td class="td_label BDLY_SRC_class_lb_lbl">CLEANER NAME</td><td><select class="BDLY_SRC_class_Searchbtn_list_box BDLY_SCR_Field" name="BDLY_SRC_lb_cleanername" id="BDLY_SRC_lb_cleanername" ><option>SELECT</option></select></td></tr>'; 
var TempAccountTR ='<tr id="BDLY_SRC_tr_searchopt_accountno" class="BDLY_SRC_class_dynamicrows" ><td class="td_label BDLY_SRC_class_lb_lbl">ACCOUNT NO</td><td><select  class="BDLY_SRC_class_Searchbtn_list_box BDLY_SCR_Field" name="BDLY_SRC_lb_accountno" id="BDLY_SRC_lb_accountno" ><option>SELECT</option></select></td></tr>'; 
var TempFromamtTR ='<tr id="BDLY_SRC_tr_searchopt_fromamt" class="BDLY_SRC_class_dynamicrows" ><td class="td_label">FROM AMOUNT</td><td ><input class="BDLY_SCR_Field" type="text" id="BDLY_SRC_tb_fromamt" name="BDLY_SRC_tb_fromtoamnt" /></td></tr>';
var TempToamtTR ='<tr id="BDLY_SRC_tr_searchopt_toamt" class="BDLY_SRC_class_dynamicrows" ><td class="td_label">TO AMOUNT</td><td><input class="BDLY_SCR_Field" type="text" id="BDLY_SRC_tb_toamt"  name="BDLY_SRC_tb_fromtoamnt" /></td><td class="errormsg" id="BDLY_SRC_tb_fromtoamnt_errormsg"></td></tr>';
var TempStart_DateTR ='<tr id="BDLY_SRC_tr_searchopt_startdate" class="BDLY_SRC_class_dynamicrowss" ><td class="td_label">START DATE</td><td><input  type="text" id="BDLY_SRC_startdate" name="BDLY_SRC_startdate" class="BDLY_SCR_Field datepickerbox BDLY_class_sedatechange datemandtry" /></td><td class="errormsg" id="BDLY_SRC_startdate_errormsg"></td></tr>';
var TempEnd_DateTR ='<tr id="BDLY_SRC_tr_searchopt_enddate" class="BDLY_SRC_class_dynamicrowss" ><td class="td_label">END DATE</td><td><input class="BDLY_SCR_Field datepickerbox BDLY_class_sedatechange datemandtry" type="text" id="BDLY_SRC_enddate" name="BDLY_SRC_enddate"  /></td><td class="errormsg" id="BDLY_SRC_enddate_errormsg"></td></tr>';
var TempStart_ForperiodTR ='<tr id="BDLY_SRC_tr_searchopt_startforperiod"  ><td class="td_label">START PERIOD</td><td><input type="text" name="BDLY_SRC_startforperiod" id="BDLY_SRC_startforperiod"  class="BDLY_SCR_Field BDLY_SCR_forperiod monthpicker datemandtry" /></td></tr>';
var TempEnd_ForperiodTR ='<tr id="BDLY_SRC_tr_searchopt_endforperiod"  ><td class="td_label">END PERIOD</td><td><input type="text" name="BDLY_SRC_endforperiod" id="BDLY_SRC_endforperiod"  class="BDLY_SCR_Field BDLY_SCR_forperiod monthpicker datemandtry" /></td></tr>';
var BDLY_SRC_Form_search_btn_html='<input type="button" name="BDLY_SRC_btn_search" id="BDLY_SRC_btn_search" class="btn" value="SEARCH"  />';
var TempdurationamtTR ='<tr id="BDLY_SRC_tr_searchopt_durationamt" ><td class="td_label">AMOUNT PER DURATION</td><td ><input class="BDLY_SCR_Field" type="text" id="BDLY_SRC_tb_durationamt" name="BDLY_SRC_tb_durationamt" /></td></tr>';
//CREATE DYNAMIC SEARCH FORM ELEMENTS END
//APPEND DYNAMIC ELEMENTS BASED ON THE SEARCH OPTION GROUPED START
switch (seclectFormtype)
{
case 'FROM PERIOD':
case 'TO PERIOD':
case 'INVOICE DATE':
{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR);
break;
}
case 'FOR PERIOD DURATION':
{
$('#BDLY_SRC_dynamicarea').append(TempServiceDueTR+TempCleanerNameTR+TempdurationamtTR);
BDLY_SCR_func_forperiod();
$("#BDLY_SRC_tb_durationamt").doValidation({rule:'numbersonly',prop:{integer:true,realpart:3,imaginary:2}}).width(50);
break;
}
case 'SERVICE DUE':{
$('#BDLY_SRC_dynamicarea').append(TempServiceDueTR);
BDLY_SCR_func_forperiod();
break;
}
case 'ACCOUNT NO':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempAccountTR);
break;
}
case 'INVOICE TO':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempInvoiceToTR);
break;
}
case 'DURATION':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempDurationFromTR+TempDurationToTR);
if(selectedexpense==11){
$("#BDLY_SRC_durationfrom").doValidation({rule:'numbersonly',prop:{integer:true,realpart:2,imaginary:2}}).width(40);
$("#BDLY_SRC_durationto").doValidation({rule:'numbersonly',prop:{integer:true,realpart:2,imaginary:2}}).width(40);
}
break;
}
case 'VOCIE NO':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempDigvoicenoTR);
break;
}
case 'CLEANER NAME':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempCleanerNameTR);
break;
}
case 'CARD NO':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempCardNoTR);
break;
}
case 'CAR NO':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempCarNoTR);
break;
}
case 'FOR PERIOD':{
$('#BDLY_SRC_dynamicarea').append(TempStart_ForperiodTR+TempEnd_ForperiodTR);
BDLY_SCR_func_forperiod();
break;
}
case 'COMMENTS':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempCommentsTR);
break;
}
case 'CATEGORY':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempCategoryTR+TempCusnameTR);
break;
}
case 'INVOICE AMOUNT':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempFromamtTR+TempToamtTR);
if(selectedexpense==3 ){
$("#BDLY_SRC_tb_fromamt").doValidation({rule:'numbersonly',prop:{realpart:5,imaginary:2}}).width(50);
$("#BDLY_SRC_tb_toamt").doValidation({rule:'numbersonly',prop:{realpart:5,imaginary:2}}).width(50);
}
else if(selectedexpense==10){
$("#BDLY_SRC_tb_fromamt").doValidation({rule:'numbersonly',prop:{realpart:4,imaginary:2}}).width(50);
$("#BDLY_SRC_tb_toamt").doValidation({rule:'numbersonly',prop:{realpart:4,imaginary:2}}).width(50);
}
else if((selectedexpense==1)||(selectedexpense==2)||(selectedexpense==5)){
var BDLY_SRC_realpartamt=3;
if(selectedexpense==2)
BDLY_SRC_realpartamt=4;
$("#BDLY_SRC_tb_fromamt").doValidation({rule:'numbersonly',prop:{integer:true,realpart:BDLY_SRC_realpartamt,imaginary:2}}).width(55);
$("#BDLY_SRC_tb_toamt").doValidation({rule:'numbersonly',prop:{integer:true,realpart:BDLY_SRC_realpartamt,imaginary:2}}).width(55);
}
else{
$("#BDLY_SRC_tb_fromamt").doValidation({rule:'numbersonly',prop:{realpart:3,imaginary:2}}).width(40);
$("#BDLY_SRC_tb_toamt").doValidation({rule:'numbersonly',prop:{realpart:3,imaginary:2}}).width(40);
}
break;
}
case 'INVOICE FROM':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempInvoiceFromTR);
break;
}
case 'INVOICE ITEMS':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempItemsTR);
break;
}
case 'SERVICED BY':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempServiceByTR);
break;
}
case 'UNIT NO':{
$('#BDLY_SRC_dynamicarea').append(TempStart_DateTR+TempEnd_DateTR+TempUnitTR);
break;
}
}
var maxinidate= new Date();
                var maxdatyr =maxinidate.getFullYear()+2;
                maxdatyr=new Date(maxinidate.setFullYear(maxdatyr));
$(".BDLY_class_sedatechange").datepicker({dateFormat: "dd-mm-yy",changeYear: true,changeMonth: true});
$('.BDLY_class_sedatechange').datepicker("option","minDate",new Date(1969, 10 , 19));
if((selectedSearchopt!=129)&&(selectedSearchopt!=130)&&(selectedSearchopt!=155)&&(selectedSearchopt!=158)&&(selectedSearchopt!=162)&&(selectedSearchopt!=166)&&(selectedSearchopt!=180)&&(selectedSearchopt!=183)&&(selectedSearchopt!=184))
$('#BDLY_SRC_enddate,#BDLY_SRC_startdate').datepicker("option","maxDate",new Date());
else
$('#BDLY_SRC_enddate,#BDLY_SRC_startdate').datepicker("option","maxDate",maxdatyr);
$( ".BDLY_SRC_class_dynamicrows" ).hide();
}}
//APPEND DYNAMIC ELEMENTS BASED ON THE SEARCH OPTION GROUPED END
});
//COMMON FUNCTION FOR FOR PERIOD VALIDATION
function BDLY_SCR_func_forperiod(){
var selectedSearchopt = $('#BDLY_SRC_lb_serachopt').val();
var BDLY_SRC_getsearch_optiontypearray=["CATEGORY","ACCOUNT NO","INVOICE TO","CLEANER NAME","CARD NO","CAR NO","SERVICED BY","UNIT NO","VOCIE NO"];
var BDLY_SRC_getsearch_optiontypeval=BDLY_SRC_getsearch_optiontype(selectedSearchopt)
$('.BDLY_SCR_forperiod').datepicker( {changeMonth: true,  changeYear: true,  showButtonPanel: true,  dateFormat: 'MM-yy',    
maxDate:new Date(),
onClose: function(dateText, inst) {
var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
$(this).datepicker('setDate', new Date(year, month, 1));
$(this).blur();
if(($(this).attr('id')=='BDLY_SRC_startforperiod')||($(this).attr('id')=='BDLY_SRC_servicedue')){
BDLY_SCR_monthBefore=month;BDLY_SCR_yearBefore=year;
$('#BDLY_SRC_btn_search').show();
}
if($("#BDLY_SRC_endforperiod").val()==''||$("#BDLY_SRC_endforperiod").val()=='')
BDLY_SRC_btn_validation = false;
else if($("#BDLY_SRC_servicedue").val()=='')
BDLY_SRC_btn_validation = false;
else
$('.auto').val('')
var BDLY_SRC_servicedue=$('#BDLY_SRC_servicedue').val(),selectedexpense=$('#BDLY_SRC_lb_ExpenseList').val();
if(selectedexpense==11&&selectedSearchopt==142){
if(BDLY_SRC_getsearch_optiontypeval=="FOR PERIOD DURATION"&&BDLY_SRC_servicedue!="")
{
$(".preloader").show();
//var  newPos= adjustPosition($(this).position(),100,230);
//resetPreloader(newPos);
$( ".BDLY_SRC_class_dynamicrows" ).show();
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_exp_cleanername).BDLY_SRC_get_cleanername(BDLY_SRC_servicedue,BDLY_SRC_servicedue,selectedSearchopt);
}
}},
beforeShow : function(selected) {
$("#BDLY_SRC_endforperiod").datepicker("option","minDate", new Date(BDLY_SCR_yearBefore, BDLY_SCR_monthBefore ,1));
} });
$(".BDLY_SCR_forperiod").focus(function () {
$(".ui-datepicker-calendar").hide();
$("#ui-datepicker-div").position({ my: "left top", at: "left bottom", of: $(this)});});
}
/*------------------------------------------SEARCH FORM SEARCH BUTTON VALIDATION --------------------------------------------------------*/
$(document).on('change blur','.BDLY_SCR_Field',function(){
$('textarea').height(20);
$('#BDLY_SRC_div_searchresult_head').text("")
$('#BDLY_SRC_div_searchresult').text("")
var BDLY_SRC_btn_validation = true;
$( ".BDLY_SCR_Field" ).each(function( index ) {
var val =$.trim($(this).val());
if(val == "" || val == 0 || $(this).hasClass('invalid') ) {
BDLY_SRC_btn_validation = false;
} });
if($('#BDLY_SRC_lb_cusname').val()!=undefined){
if($('#BDLY_SRC_lb_cusname').val()=='')
BDLY_SRC_btn_validation = false;
}
if($('#BDLY_SRC_durationfrom').val()!=undefined){
if((($('#BDLY_SRC_durationfrom').val().length!='')&&($('#BDLY_SRC_durationfrom').val()!=undefined))||(($('#BDLY_SRC_durationto').val().length!='')&&($('#BDLY_SRC_durationto').val()!=undefined))){
$(this).removeClass('invalid')
var BDLY_SRC_duration=$(this).val().split('.')
var BDLY_SRC_durhrs=parseInt(BDLY_SRC_duration[0])
var BDLY_SRC_durmin=parseInt(BDLY_SRC_duration[1])
if(( BDLY_SRC_durhrs<=24) || (BDLY_SRC_durhrs=='')|| (BDLY_SRC_durhrs==undefined)|| (BDLY_SRC_durhrs==0)){
$('#BDLY_SCR_lbl_err_durationhrs').html('')
if(( BDLY_SRC_durmin<60) || (BDLY_SRC_durmin=='')|| (BDLY_SRC_durmin==undefined)||(BDLY_SRC_durmin==00)||isNaN(BDLY_SRC_durmin)||(BDLY_SRC_durmin==0)){
$('#BDLY_SCR_lbl_err_durationmin').html('')
if(($('#BDLY_SRC_durationfrom').val().length!='')&&($('#BDLY_SRC_durationto').val().length!='')&&(parseFloat($('#BDLY_SRC_durationfrom').val()) > parseFloat($('#BDLY_SRC_durationto').val() ))){
$('#BDLY_SCR_lbl_err_duration').html(BDLY_SRC_finalerrr[5])}
else
$('#BDLY_SCR_lbl_err_duration').html('')
}
else{
$(this).addClass('invalid')
$('#BDLY_SCR_lbl_err_durationmin').html(BDLY_SRC_finalerrr[4])
$('#BDLY_SCR_lbl_err_durationhrs,#BDLY_SCR_lbl_err_duration').html('');
}}
else if(BDLY_SRC_durhrs>24){
$('#BDLY_SCR_lbl_err_durationhrs').html(BDLY_SRC_finalerrr[3])
$('#BDLY_SCR_lbl_err_durationmin,#BDLY_SCR_lbl_err_duration').html('');
$(this).addClass('invalid')
}
if((parseFloat($('#BDLY_SRC_durationfrom').val()) > parseFloat($('#BDLY_SRC_durationto').val()) )||( $('#BDLY_SRC_durationfrom').val().split('.')[0]>24)||($('#BDLY_SRC_durationfrom').val().split('.')[1]>60 )||( $('#BDLY_SRC_durationto').val().split('.')[0]>24)||($('#BDLY_SRC_durationto').val().split('.')[1]>60 )){
ErrorControl.AmountCompare="InValid";
}
else{
$('#BDLY_SCR_lbl_err_durationhrs,#BDLY_SCR_lbl_err_duration,#BDLY_SCR_lbl_err_durationmin').html('');
ErrorControl.AmountCompare="Valid";}
if(ErrorControl.AmountCompare=="InValid"){
BDLY_SRC_btn_validation = false;
$('#BDLY_SRC_btn_search').attr("disabled", "disabled");
}
else if(ErrorControl.AmountCompare!="InValid" && BDLY_SRC_btn_validation != false )
$('#BDLY_SRC_btn_search').removeAttr("disabled");
}}
if(($('#BDLY_SRC_tb_fromamt').val()!=undefined)&&($('#BDLY_SRC_tb_toamt').val()!=undefined)){
var BDLY_SRC_tb_fromamt_plain=$('#BDLY_SRC_tb_fromamt').val();
var BDLY_SRC_tb_fromamt=parseFloat(BDLY_SRC_tb_fromamt_plain);
var BDLY_SRC_tb_toamt_plain=$('#BDLY_SRC_tb_toamt').val();
var BDLY_SRC_tb_toamt=parseFloat(BDLY_SRC_tb_toamt_plain);
if(BDLY_SRC_tb_fromamt <= BDLY_SRC_tb_toamt && BDLY_SRC_tb_fromamt!='')
ErrorControl.AmountCompare="Valid";
else
ErrorControl.AmountCompare="InValid";
if(ErrorControl.AmountCompare=="InValid"){
BDLY_SRC_btn_validation = false;
$('#BDLY_SRC_btn_search').attr("disabled", "disabled");
}
else if(ErrorControl.AmountCompare!="InValid" && BDLY_SRC_btn_validation != false )
$('#BDLY_SRC_btn_search').removeAttr("disabled");
if(isNaN(BDLY_SRC_tb_fromamt) || isNaN(BDLY_SRC_tb_toamt))
$('#BDLY_SRC_tb_fromtoamnt_errormsg').html('');
else if( ErrorControl.AmountCompare=="InValid" && BDLY_SRC_tb_fromamt!='' && BDLY_SRC_tb_toamt!='')
$('#BDLY_SRC_tb_fromtoamnt_errormsg').html(BDLY_SRC_finalerrr[2]);
else $('#BDLY_SRC_tb_fromtoamnt_errormsg').html('');
}
if((BDLY_SRC_btn_validation==false)||(BDLY_SRC_btn_dbvalues==false)){
$('#BDLY_SRC_btn_search').attr("disabled", "disabled");}
else if($('.auto').length==0)
$('#BDLY_SRC_btn_search').removeAttr("disabled");
});
/*-------------------FUNCTION TO SHOW SEARCH BUTTON OF FOR PERIOD DATE PICKER------------------------*/
$(document).on('change','.BDLT_SRC_Month_picker',function(){
$('#BDLY_SRC_btn_search').show();
});
/*-------------------FUNCTION TO VALIDATE SEARCH BUTTON WITH CUSTOMER NAME LIST BOX FOR UNIT EXP CATEGORY------------------------*/
$(document).on('change','#BDLY_SRC_lb_cusname',function(){
if($(this).val()==""){
$('#BDLY_SRC_btn_search').attr("disabled", "disabled");}
else
$('#BDLY_SRC_btn_search').removeAttr("disabled");
});
/*------------------------------------------FUNCTION TO BIND EXPENSE CATEGORY IN LB --------------------------------------------------------*/
function BDLY_SRC_success_exp_catgdata(BDLY_expcateg_response){
if(BDLY_expcateg_response.length==0)
{
$('#BDLY_SRC_lb_category').hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
else
{
$('#BDLY_SRC_nodyndataerr').text("")
Unit_Exp_Category=BDLY_expcateg_response;
if($('#BDLY_SRC_lb_category').length>0){
var options='<option value="">SELECT</option>';
for (var i = 0; i <BDLY_expcateg_response.length; i++) {
options +='<option value="'+BDLY_expcateg_response[i].key +'">' + BDLY_expcateg_response[i].value + '</option>';
}
$('#BDLY_SRC_lb_category').html(options).show();
}
$( ".BDLY_SRC_class_lb_lbl" ).show();
$('#BDLY_SRC_tr_searchopt_cusname').hide();
}
$( ".BDLY_SRC_class_dynamicrows" ).show();
$(".preloader").fadeOut(500);
}
/*------------------------------------------TO BIND UNIT  NO IN LISTBOX----------------------------------------------------*/
function BDLY_SRC_success_exp_unitno(BDLY_unitno_response){
if($('#BDLY_SRC_tr_searchopt_enddate').next().find('select').length>0)
var select_elem =$('#BDLY_SRC_tr_searchopt_enddate').next().find('select');
else var select_elem =$('#BDLY_SRC_dynamicarea').find('select');
if(BDLY_unitno_response.length==0)
{
select_elem.hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
else
{
$('#BDLY_SRC_nodyndataerr').text("")
var options='<option value="">SELECT</option>';
for (var i = 0; i <BDLY_unitno_response.length; i++) {
options +='<option value="'+BDLY_unitno_response[i].key +'">' + BDLY_unitno_response[i].value + '</option>';
}
select_elem.html(options).show();
$( ".BDLY_SRC_class_lb_lbl" ).show();
}
$(".preloader").fadeOut(500);
}
/*------------------------------------------TO BIND DIGITAL VOICE NO IN LISTBOX----------------------------------------------------*/
function BDLY_SRC_success_exp_digitalvoiceno(BDLY_digvoiceno_response){
if($('#BDLY_SRC_tr_searchopt_enddate').next().find('select').length>0)
var select_elem =$('#BDLY_SRC_tr_searchopt_enddate').next().find('select');
else var select_elem =$('#BDLY_SRC_dynamicarea').find('select');
if(BDLY_digvoiceno_response.length==0)
{
select_elem.hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
else
{
$('#BDLY_SRC_nodyndataerr').text("")
var options='<option value="">SELECT</option>';
for (var i = 0; i <BDLY_digvoiceno_response.length; i++) {
options +='<option value="'+BDLY_digvoiceno_response[i].key +'">' + BDLY_digvoiceno_response[i].key + '</option>';
}
select_elem.html(options).show();
$( ".BDLY_SRC_class_lb_lbl" ).show();
}
$(".preloader").fadeOut(500);
}
/*------------------------------------------FUNCTION TO GET CUSTOMER NAME FOR  LB --------------------------------------------------------*/
$(document).on('change','#BDLY_SRC_lb_category',function(){
if($(this).val()==23 && startdate!="" && enddate!=""){
$(".preloader").show();
//var  newPos= adjustPosition($(this).position(),100,230);
//resetPreloader(newPos);
$('#BDLY_SRC_btn_search').attr("disabled", "disabled");
$('#BDLY_SRC_tr_searchopt_cusname').show();
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_cusname).BDLY_SRC_get_cusname(null,startdate,enddate);
}
else $('#BDLY_SRC_tr_searchopt_cusname').hide();
});
/*------------------------------------------TO BIND CUSTOMER NAME NO IN LISTBOX----------------------------------------------------*/
function BDLY_SRC_success_cusname(response){
if(response.length==0)
{
$('#BDLY_SRC_lb_cusname').hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
else
{
$('#BDLY_SRC_nodyndataerr').text("")
var options='<option value="">SELECT</option>';
for (var i = 0; i <response.length; i++) {
options +='<option value="'+response[i].key +'">' + response[i].value +'</option>';
}
$('#BDLY_SRC_lb_cusname').html(options).show();
$('.BDLY_SRC_class_lb_lbl').show();
}
$(".preloader").fadeOut(500);
}
/*------------------------------------------TO BIND ACCESS CARD NO IN LISTBOX----------------------------------------------------*/
function BDLY_SRC_success_cardno(response){$(".preloader").fadeOut(500);
if(response.length==0)
{
$('#BDLY_SRC_lb_cardno').hide();
$(".BDLY_SRC_class_lb_lbl").hide();
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
else
{
$('#BDLY_SRC_nodyndataerr').text("")
var options='<option value="">SELECT</option>';
for (var i = 0; i <response.length; i++) {
options +='<option value="'+response[i].key +'">'+response[i].value+'</option>';
}
$('#BDLY_SRC_lb_cardno').html(options).show();
$( ".BDLY_SRC_class_lb_lbl" ).show();
}
$(".preloader").fadeOut(500);
}
/*------------------------------------------TO BIND CAR NO IN LISTBOX----------------------------------------------------*/
function BDLY_SRC_success_carno(response){
if(response.length==0)
{
$('#BDLY_SRC_lb_carno').hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
else
{
$('#BDLY_SRC_nodyndataerr').text("")
var options='<option value="">SELECT</option>';
for (var i = 0; i <response.length; i++) {
options +='<option value="'+response[i].key +'">'+response[i].key+'</option>';
}
$('#BDLY_SRC_lb_carno').html(options).show();
$( ".BDLY_SRC_class_lb_lbl" ).show();
}
$(".preloader").fadeOut(500);
}
/*------------------------------------------TO BIND SERVICE BY IN LISTBOX----------------------------------------------------*/
function BDLY_SRC_success_serviceby(response){
if(response.length==0)
{
$('#BDLY_SRC_lb_serviceby').hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
else
{
$('#BDLY_SRC_nodyndataerr').text("")
var options='<option value="">SELECT</option>';
for (var i = 0; i <response.length; i++) {
options +='<option value="'+response[i].key +'">'+response[i].key+'</option>';
}
$('#BDLY_SRC_lb_serviceby').html(options).show();
$( ".BDLY_SRC_class_lb_lbl" ).show();
}
$(".preloader").fadeOut(500);
}
/*------------------------------------------TO BIND CLEANERNAME IN LISTBOX----------------------------------------------------*/
function BDLY_SRC_success_exp_cleanername(response){
var selectedSearchopt = $('#BDLY_SRC_lb_serachopt').val();
if(response.length==0)
{
BDLY_SRC_btn_dbvalues = false;
$('#BDLY_SRC_btn_search').attr("disabled", "disabled");
$('#BDLY_SRC_lb_cleanername').hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
if(selectedSearchopt==142)
{
if(BDLY_SRC_finalerrr[1].match("[FP]"))
{
var BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[FP]",$("#BDLY_SRC_servicedue").val())
}
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_errormessagenodata);
}
else
{
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
}
else
{
BDLY_SRC_btn_dbvalues=true;
$('#BDLY_SRC_nodyndataerr').text("")
var options='<option value="">SELECT</option>';
for (var i = 0; i <response.length; i++) {
options +='<option value="'+response[i].key +'">' +response[i].value+'</option>';
}
$('#BDLY_SRC_lb_cleanername').html(options).show();
$( ".BDLY_SRC_class_lb_lbl" ).show();
}
$(".preloader").fadeOut(500);
}
/*------------------------------------------TO BIND ACCOUNT NO IN LISTBOX----------------------------------------------------*/
function BDLY_SRC_success_exp_accountno(response){
if(response.length==0)
{
$('#BDLY_SRC_lb_accountno').hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
else
{
$('#BDLY_SRC_nodyndataerr').text("")
var options='<option value="">SELECT</option>';
for (var i = 0; i <response.length; i++) {
options +='<option value="'+response[i].value +'">' +response[i].value+'</option>';
}
$('#BDLY_SRC_lb_accountno').html(options).show();
$( ".BDLY_SRC_class_lb_lbl" ).show();
}
$(".preloader").fadeOut(500);
}
/*------------------------------------------TO BIND INVOCIE OPTION IN LISTBOX----------------------------------------------------*/
function BDLY_SRC_success_digital_invoiceto(response){
if(response.length==0)
{
$('#BDLY_SRC_lb_invoiceto').hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
$('#BDLY_SRC_nodyndataerr').text(BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2]));
}
else
{
$('#BDLY_SRC_nodyndataerr').text("")
var options='<option value="">SELECT</option>';
for (var i = 0; i <response.length; i++) {
options +='<option value="'+response[i].key +'">' +response[i].value+'</option>';
}
$('#BDLY_SRC_lb_invoiceto').html(options).show();
$( ".BDLY_SRC_class_lb_lbl" ).show();
}
$(".preloader").fadeOut(500);
}
/*---------------------------------FOR PERIOD SEARCH BUTTON VALIDATION--------------------------------------------*/
$(document).on('change','#BDLY_SRC_startforperiod,#BDLY_SRC_endforperiod',function(){
$( ".BDLY_SRC_class_dynamicrows" ).show();
$('#BDLY_SRC_btn_search').show();
});
//FUNCTION TO CALL DATE PICKER FORMAT TO SHOW IN FORM ELEMENTS
function FormTableDateFormat(inputdate){
var string = inputdate.split("-");
return string[2]+'-'+ string[1]+'-'+string[0];
}
/*------------------------------------------TO PERFORM AUTO COMPLETE DATA OR DYNAMIC DATA RANGE TO APPEND IN LIST BOX-------------------------------------------------------*/
$(document).on('change','.BDLY_class_sedatechange,.BDLT_SRC_Month_picker',function(){
var BDLY_SRC_searchoptionarr={1:[159],2:[179],3:[185,189,190],4:[167],5:[153],6:[175],7:[171],8:[128],9:[125],10:[139,140],11:[143],12:[146]};
var selectedSearchopt = $('#BDLY_SRC_lb_serachopt').val(),selectedexpense=$('#BDLY_SRC_lb_ExpenseList').val();
var BDLY_SRC_getsearch_optiontypearray=["CATEGORY","ACCOUNT NO","INVOICE TO","CLEANER NAME","CARD NO","CAR NO","SERVICED BY","UNIT NO","VOCIE NO"];
var BDLY_SRC_getsearch_optiontypeval=BDLY_SRC_getsearch_optiontype(selectedSearchopt)
startdate=$('#BDLY_SRC_startdate').val();enddate=$('#BDLY_SRC_enddate').val();
var BDLY_SRC_servicedue=$('#BDLY_SRC_servicedue').val();
//SET END DATE OR END FOR PERIOD START
if(startdate!="")
{
var BDLY_SRC_in_sdate = new Date( Date.parse( FormTableDateFormat(startdate)) ); 
BDLY_SRC_in_sdate.setDate( BDLY_SRC_in_sdate.getDate());  
var BDLY_SRC_in_sdate = BDLY_SRC_in_sdate.toDateString(); 
BDLY_SRC_in_sdate = new Date( Date.parse( BDLY_SRC_in_sdate ) ); 
$('#BDLY_SRC_enddate').datepicker("option","minDate",BDLY_SRC_in_sdate);
}
//SET END DATE OR END FOR PERIOD END
if(startdate!="" && enddate!=""){
if(BDLY_SRC_searchoptionarr[selectedexpense].indexOf(parseInt(selectedSearchopt))>-1)
{
var  newPos= adjustPosition($(this).position(),100,190);
resetPreloader(newPos);
$(".preloader").show();
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_autodata).BDLY_SRC_get_autocomplete(document.getElementById('BDLY_SRC_form'));
}
else
{
if(BDLY_SRC_getsearch_optiontypearray.indexOf(BDLY_SRC_getsearch_optiontypeval)>-1)
{
var  newPos= adjustPosition($(this).position(),100,190);
resetPreloader(newPos);
$(".preloader").show();
}
if(BDLY_SRC_getsearch_optiontypeval=="CATEGORY"){
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_exp_catgdata).BDLY_SRC_getUnitexp_catg(startdate,enddate,0);
}
else if(BDLY_SRC_getsearch_optiontypeval=="ACCOUNT NO")
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_exp_accountno).BDLY_SRC_get_accountno(selectedexpense,startdate,enddate);
}
else if(BDLY_SRC_getsearch_optiontypeval=="INVOICE TO")
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_digital_invoiceto).BDLY_SRC_invoiceto(selectedexpense,selectedSearchopt,startdate,enddate);
}  
else if(BDLY_SRC_getsearch_optiontypeval=="CLEANER NAME")
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_exp_cleanername).BDLY_SRC_get_cleanername(startdate,enddate,selectedSearchopt);
}
else if(BDLY_SRC_getsearch_optiontypeval=="CARD NO")
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_cardno).BDLY_SRC_getPurchase_card(startdate,enddate);
}
else if(BDLY_SRC_getsearch_optiontypeval=="CAR NO")
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_carno).BDLY_SRC_getCarNoList(startdate,enddate);
}
else if(BDLY_SRC_getsearch_optiontypeval=="SERVICED BY")
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_serviceby).BDLY_SRC_getServiceByList(startdate,enddate);
}
else if(BDLY_SRC_getsearch_optiontypeval=="UNIT NO")
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_exp_unitno).BDLY_SRC_getUnitList(selectedexpense,selectedSearchopt,startdate,enddate);
}
else if(BDLY_SRC_getsearch_optiontypeval=="VOCIE NO")
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_success_exp_digitalvoiceno).BDLY_SRC_getDigitalVoiceNo(startdate,enddate);
}
}
if(BDLY_SRC_getsearch_optiontypeval=="TO PERIOD"||
BDLY_SRC_getsearch_optiontypeval=="FROM PERIOD"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE DATE"||
BDLY_SRC_getsearch_optiontypeval=="FOR PERIOD"
)
{
$('#BDLY_SRC_btn_search').removeAttr("disabled").show()
}
else
{
if(BDLY_SRC_getsearch_optiontypeval!='INVOICE AMOUNT')
$('#BDLY_SRC_btn_search').attr("disabled", "disabled").show();
}
$('#BDLY_SRC_btn_search').show();
$( ".BDLY_SRC_class_dynamicrows" ).show();
}
});
/*------------------------------------------FUNCTION TO AUTOCOMPLETE SEARCH TEXT--------------------------------------------------------*/
function BDLY_SRC_success_autodata(BDLY_autocompl_response)
{
///*--------------------------------------------CALL FUNCTION TO HIGHLIGHT SEARCH TEXT---------------------------------------------------*/
var searchoption_elem =$('#BDLY_SRC_tr_searchopt_enddate').next().find('.auto');
var response_len = BDLY_autocompl_response.length;
highlightSearchText();
searchoption_elem.autocomplete({
source: BDLY_autocompl_response,
select:AutoCompleteSelectHandler
});
if(response_len>0){
searchoption_elem.removeAttr("disabled").attr('placeholder',response_len+' Records Matching').val('');
}
else{
searchoption_elem.attr("disabled", "disabled").attr('placeholder',BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[2])).val('');
}
$(".preloader").fadeOut(500);
}
/*----------------------------------------------------FUNCTION TO HIGHLIGHT SEARCH TEXT------------------------------------------------------------------------*/
function highlightSearchText() {
$.ui.autocomplete.prototype._renderItem = function( ul, item) {
var re = new RegExp(this.term, "i") ;
var t = item.label.replace(re,"<span class=autotxt>" + this.term + "</span>");//higlight color,class shld be same as here
return $( "<li></li>" )
.data( "item.autocomplete", item )
.append( "<a>" + t + "</a>" )
.appendTo( ul );
};
}
/*---------------------------------------------------FUNCTION TO GET SELECTED VALUE----------------------------------------------------------------*/
function AutoCompleteSelectHandler(event, ui) {
BDLY_SRC_flag_autocom=ui.item.value;
if(BDLY_SRC_flag_autocom!='' && $('#BDLY_SRC_startdate').val()!="" && $('#BDLY_SRC_enddate').val()!="" )
$('#BDLY_SRC_btn_search').removeAttr("disabled");
else
$('#BDLY_SRC_btn_search').attr("disabled", "disabled");
}
/*----------------------------------FUNCTION TO DISABLE SEARCH BUTTON IF ANY INPUT IN AUTO COMPLETE FIELD---------------------------------*/
$(document).on('keypress keydown','.auto',function(e){
if (e.which ==13 && $('#BDLY_SRC_startdate').val()!="" && $('#BDLY_SRC_enddate').val()!="" && BDLY_SRC_flag_autocom!='') {
$('#BDLY_SRC_btn_search').removeAttr("disabled");
}else
$('#BDLY_SRC_btn_search').attr("disabled", "disabled");
});
/*----------------------------------FUNCTION TO GET SEARCH RESULT OF INPUT VALUES---------------------------------------------*/
$(document).on('click','#BDLY_SRC_btn_search',function(){
var  newPos= adjustPosition($(this).position(),100,190);
resetPreloader(newPos);
$(".preloader").show();
BDLY_SRC_sucsval=0;
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_UpdateDataTable).BDLY_SRC_getAnyTypeExpData(document.getElementById('BDLY_SRC_form'));
});
//FUNCTION TO REPLACE ERROR MESSAGE
function BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrrvalues)
{
var BDLY_SRC_errormessage;
if(BDLY_SRC_finalerrrvalues.match("[SDATE]"))
{
BDLY_SRC_errormessage=BDLY_SRC_finalerrrvalues.replace("[SDATE]",$("#BDLY_SRC_startdate").val())
BDLY_SRC_errormessage=BDLY_SRC_errormessage.replace("[EDATE]",$("#BDLY_SRC_enddate").val())
}
return BDLY_SRC_errormessage;
}
var oTable;
//FUNCTION TO UPDATE DATA TABLE DYNAMICALLY FOR THE SEARCH RESULT
function BDLY_SRC_UpdateDataTable(reaponse){
BDLY_SRC_arr_unitcmts=reaponse[3];
$('#BDLY_SRC_div_searchresult_head').text("")
var selectedSearchopt=$("#BDLY_SRC_lb_serachopt").val(),
BDLY_SRC_selectedexptype=$("#BDLY_SRC_lb_ExpenseList").val(),
BDLY_SRC_getsearch_optiontypeval=BDLY_SRC_getsearch_optiontype(selectedSearchopt);
//CHK SEARCH OPTION TYPE
if(BDLY_SRC_getsearch_optiontypeval=="COMMENTS"||
BDLY_SRC_getsearch_optiontypeval=="CAR NO"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE ITEMS"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE FROM"||
BDLY_SRC_getsearch_optiontypeval=="UNIT NO"||
BDLY_SRC_getsearch_optiontypeval=="CARD NO"||
BDLY_SRC_getsearch_optiontypeval=="CLEANER NAME"||
BDLY_SRC_getsearch_optiontypeval=="ACCOUNT NO"||
BDLY_SRC_getsearch_optiontypeval=="VOCIE NO"||
BDLY_SRC_getsearch_optiontypeval=="SERVICED BY"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE TO"||
BDLY_SRC_getsearch_optiontypeval=="CATEGORY"
)
{
$( ".BDLY_SRC_class_Searchbtn_list_box" ).hide();
$( ".BDLY_SRC_class_lb_lbl" ).hide();
$( ".BDLY_class_sedatechange" ).val("");
$( ".BDLY_SRC_class_dynamicrows" ).hide();
$( "#BDLY_SRC_btn_search" ).hide();
}
else
{
$( ".BDLY_SRC_class_dynamicrows" ).show();
if(selectedSearchopt!=198)
{
$( "#BDLY_SRC_btn_search" ).show();
}
}
var selectedSearchopt = $('#BDLY_SRC_lb_serachopt').val();
if((selectedSearchopt!=129)&&(selectedSearchopt!=130)&&(selectedSearchopt!=155)&&(selectedSearchopt!=157)&&(selectedSearchopt!=162)&&(selectedSearchopt!=166)&&(selectedSearchopt!=180)&&(selectedSearchopt!=183)&&(selectedSearchopt!=184))
$('#BDLY_SRC_enddate,#BDLY_SRC_startdate').datepicker("option","maxDate",new Date());
else
$( ".BDLY_class_sedatechange" ).datepicker('option', {minDate: null, maxDate: null});
var resultarray=reaponse[0];
unit_start_end_date_obj=reaponse[1];
var BIZDLY_SRC_tablewidth=reaponse[2];
$("#BDLY_SRC_div_searchresult").html('').append('<table class="srcresult" id="BDLY_SRC_tb_DataTableId" style="width:'+BIZDLY_SRC_tablewidth+'px" hidden><thead><tr></tr></thead><tbody></tbody></table>');
$.each( resultarray[0], function( key, header ) {
var gsheader=header.replace(/ /g,'&nbsp;');
var Header=gsheader.split("^")[0];
var headerwidth=gsheader.split("^")[1];
if(headerwidth!=undefined)
{
if(Header=='SNO')
$("<th style='width:"+headerwidth+"px;display:none'>"+Header+"</th>").addClass(resultarray[1][key]).appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
else if((Header=='INVOICE&nbsp;DATE')||(Header=='INVOICE&nbsp;DATE<em>*</em>')||(Header=='FROM&nbsp;PERIOD<em>*</em>')||(Header=='TO&nbsp;PERIOD<em>*</em>')||(Header=='WORK&nbsp;DATE<em>*</em>')||(Header=='PAID&nbsp;DATE<em>*</em>'))
$("<th style='width:"+headerwidth+"px'>"+Header+"</th>").addClass(resultarray[1][key]).addClass("uk-date-column").appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
else if(Header=='FOR&nbsp;PERIOD<em>*</em>')
$("<th style='width:"+headerwidth+"px'>"+Header+"</th>").addClass(resultarray[1][key]).addClass("uk-forperiod-column").appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
else if(Header=='TIMESTAMP')
$("<th style='width:"+headerwidth+"px'>"+Header+"</th>").addClass(resultarray[1][key]).addClass("uk-timestp-column").appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
else
$("<th style='width:"+headerwidth+"px'>"+Header+"</th>").addClass(resultarray[1][key]).appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
}
else
{
if(Header=='SNO')
$("<th style='display:none'>"+Header+"</th>").addClass(resultarray[1][key]).appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
else if((Header=='INVOICE&nbsp;DATE')||(Header=='INVOICE&nbsp;DATE<em>*</em>')||(Header=='FROM&nbsp;PERIOD<em>*</em>')||(Header=='TO&nbsp;PERIOD<em>*</em>')||(Header=='WORK&nbsp;DATE<em>*</em>')||(Header=='PAID&nbsp;DATE<em>*</em>'))
$("<th style='width:"+headerwidth+"px'>"+Header+"</th>").addClass(resultarray[1][key]).addClass("uk-date-column").appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
else if(Header=='FOR&nbsp;PERIOD<em>*</em>')
$("<th style='width:"+headerwidth+"px'>"+Header+"</th>").addClass(resultarray[1][key]).addClass("uk-forperiod-column").appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
else if(Header=='TIMESTAMP')
$("<th style='width:"+headerwidth+"px'>"+Header+"</th>").addClass(resultarray[1][key]).addClass("uk-timestp-column").appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
else
$("<th style='width:"+headerwidth+"px'>"+Header+"</th>").addClass(resultarray[1][key]).appendTo("#BDLY_SRC_tb_DataTableId > thead >tr");
}
});
if(BDLY_SRC_selectedexptype==10||selectedSearchopt==198)
{
$("#BDLY_SRC_tb_DataTableId > thead >tr"). append("<th style='width:200px'>EDIT/UPDATE/CANCEL</th>");
}
else if(selectedSearchopt!=142)
{
$("#BDLY_SRC_tb_DataTableId > thead >tr"). append("<th style='width:200px'>EDIT/UPDATE/DELETE/CANCEL</th>");
}
$.each(resultarray, function(index, row) {
if (index < 2) return;
var tr = $("#BDLY_SRC_tb_DataTableId >tbody").append("<tr></tr>");
var eachcell;
$.each( row, function( key, cell ) {
var selectedSearchopt = $('#BDLY_SRC_lb_serachopt').val();
if(key==0)
var keyid=cell;
var cell = ((cell==null)?"":cell);
if((key==0)&&(selectedSearchopt!=142))
eachcell +='<td style="display:none;">'+cell+'</td>';
else if(key==1)
eachcell +='<td class="unitno">'+cell+'</td>';
else
eachcell +='<td >'+cell+'</td>'; 
});
$("#BDLY_SRC_tb_DataTableId >tbody >tr:last").append(eachcell);
var selectedSearchopt=$("#BDLY_SRC_lb_serachopt").val(),
BDLY_SRC_selectedexptype=$("#BDLY_SRC_lb_ExpenseList").val();
if(BDLY_SRC_selectedexptype==10||selectedSearchopt==198)
{
var BDLY_SRC_delbtn='<input type="button" class="multirowbtn delete" value="Delete" style="display: none;">';
}
else
{
var BDLY_SRC_delbtn='<input type="button" class="multirowbtn delete" value="Delete" >';
}
if(selectedSearchopt!=142)
{
$("#BDLY_SRC_tb_DataTableId >tbody >tr:last").append('<td><input type="button" class="multirowbtn edit" value="Edit">'+BDLY_SRC_delbtn+'</td>'); //myButton
}
});
jQuery.fn.dataTableExt.oSort['uk_date-asc']  = function(a,b) { 
   var x = new Date( Date.parse(FormTableDateFormat(a))); 
    var y = new Date( Date.parse(FormTableDateFormat(b)) ); 
    return ((x < y) ? -1 : ((x > y) ?  1 : 0)); 
};  
jQuery.fn.dataTableExt.oSort['uk_date-desc'] = function(a,b) { 
    var x = new Date( Date.parse(FormTableDateFormat(a))); 
    var y = new Date( Date.parse(FormTableDateFormat(b)) ); 
    return ((x < y) ? 1 : ((x > y) ?  -1 : 0)); 
} 
jQuery.fn.dataTableExt.oSort['uk_timestp-asc']  = function(a,b) { 
    var x = new Date( Date.parse(FormTableDateFormat(a.split(' ')[0]))).setHours(a.split(' ')[1].split(':')[0],a.split(' ')[1].split(':')[1],a.split(' ')[1].split(':')[2]); 
    var y = new Date( Date.parse(FormTableDateFormat(b.split(' ')[0]))).setHours(b.split(' ')[1].split(':')[0],b.split(' ')[1].split(':')[1],b.split(' ')[1].split(':')[2]); 
    return ((x < y) ? -1 : ((x > y) ?  1 : 0));     
    }; 
jQuery.fn.dataTableExt.oSort['uk_timestp-desc'] = function(a,b) { 
  var x = new Date( Date.parse(FormTableDateFormat(a.split(' ')[0]))).setHours(a.split(' ')[1].split(':')[0],a.split(' ')[1].split(':')[1],a.split(' ')[1].split(':')[2]); 
  var y = new Date( Date.parse(FormTableDateFormat(b.split(' ')[0]))).setHours(b.split(' ')[1].split(':')[0],b.split(' ')[1].split(':')[1],b.split(' ')[1].split(':')[2]); 
    return ((x < y) ? 1 : ((x > y) ?  -1 : 0)); 
}; 
// UK Date Sorting 
jQuery.fn.dataTableExt.oSort['uk_forperiod-asc']  = function(a,b) { 
    var ukDatea = a.split('-'); var ukDateb = b.split('-'); 
        var monthArr={January:['00'],February:['01'],March:['02'],April:['03'],May:['04' ],June:['05'],July:['06'],August:['07'],September:['08'],October:['09'],November:['10'],December:['11']};
var x = new Date( ukDatea[1],monthArr[ukDatea[0]][0],1); 
var y = new Date( ukDateb[1],monthArr[ukDateb[0]][0],1); 
    return ((x < y) ? -1 : ((x > y) ?  1 : 0)); 
};  
jQuery.fn.dataTableExt.oSort['uk_forperiod-desc'] = function(a,b) { 
    var ukDatea = a.split('-');  var ukDateb =b.split('-'); 
        var monthArr={January:['00'],February:['01'],March:['02'],April:['03'],May:['04' ],June:['05'],July:['06'],August:['07'],September:['08'],October:['09'],November:['10'],December:['11']};
var x = new Date( ukDatea[1],monthArr[ukDatea[0]][0],1); 
var y = new Date( ukDateb[1],monthArr[ukDateb[0]][0],1);    
return ((x < y) ? 1 : ((x > y) ?  -1 : 0)); 
}; 
switch (BDLY_SRC_getsearch_optiontypeval)
{
case "DURATION":
{
if(BDLY_SRC_finalerrr[0].match("[SD]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[SD]",$("#BDLY_SRC_durationfrom").val())
BDLY_SRC_errormessagewitdata=BDLY_SRC_errormessagewitdata.replace("[ED]",$("#BDLY_SRC_durationto").val())
}
if(BDLY_SRC_finalerrr[1].match("[SDATE]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[SDATE]",$("#BDLY_SRC_durationfrom").val())
BDLY_SRC_errormessagenodata=BDLY_SRC_errormessagenodata.replace("[EDATE]",$("#BDLY_SRC_durationto").val())
}
break;
}
case "FOR PERIOD DURATION":
{
if(BDLY_SRC_finalerrr[0].match("[CNAME]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[CNAME]",$('#BDLY_SRC_lb_cleanername').find('option:selected').text())
BDLY_SRC_errormessagewitdata=BDLY_SRC_errormessagewitdata.replace("[FP]",$('#BDLY_SRC_servicedue').val())
BDLY_SRC_errormessagewitdata=BDLY_SRC_errormessagewitdata.replace("[DUR]",$('#BDLY_SRC_tb_durationamt').val())
}
if(BDLY_SRC_finalerrr[1].match("[CNAME]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[CNAME]",$('#BDLY_SRC_lb_cleanername').find('option:selected').text())
}
break;
}
case "CLEANER NAME":
{
if(BDLY_SRC_finalerrr[0].match("[CNAME]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[CNAME]",$('#BDLY_SRC_lb_cleanername').find('option:selected').text())
}
if(BDLY_SRC_finalerrr[1].match("[CNAME]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[CNAME]",$('#BDLY_SRC_lb_cleanername').find('option:selected').text())
}
break;
}
case "FOR PERIOD":
{
if(BDLY_SRC_finalerrr[0].match("[SDATE]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[SDATE]",$("#BDLY_SRC_startforperiod").val())
BDLY_SRC_errormessagewitdata=BDLY_SRC_errormessagewitdata.replace("[EDATE]",$("#BDLY_SRC_endforperiod").val())
}
if(BDLY_SRC_finalerrr[1].match("[SDATE]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[SDATE]",$("#BDLY_SRC_startforperiod").val())
BDLY_SRC_errormessagenodata=BDLY_SRC_errormessagenodata.replace("[EDATE]",$("#BDLY_SRC_endforperiod").val())
}
break;
}
case "CARD NO":
{
if(BDLY_SRC_finalerrr[0].match("[CARD NO]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[CARD NO]",$('#BDLY_SRC_lb_cardno').find('option:selected').text())
}
if(BDLY_SRC_finalerrr[1].match("[CARD NO]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[CARD NO]",$('#BDLY_SRC_lb_cardno').find('option:selected').text())
}
break;
}
case "CATEGORY":
{
if(BDLY_SRC_finalerrr[0].match("[TEXP]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[TEXP]",$('#BDLY_SRC_lb_category').find('option:selected').text())
}
if(BDLY_SRC_finalerrr[1].match("[TEXP]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[TEXP]",$('#BDLY_SRC_lb_category').find('option:selected').text())
}
break;
}
case "INVOICE ITEMS":
{
if(BDLY_SRC_finalerrr[0].match("[INVITEM]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[INVITEM]",$("#BDLY_SRC_invoiceitem").val())
}
if(BDLY_SRC_finalerrr[1].match("[INVITEM]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[INVITEM]",$("#BDLY_SRC_invoiceitem").val())
}
break;
}
case "INVOICE FROM":
{
if(BDLY_SRC_finalerrr[0].match("[INVFROM]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[INVFROM]",$("#BDLY_SRC_invoicefrom").val())
}
if(BDLY_SRC_finalerrr[1].match("[INVFROM]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[INVFROM]",$("#BDLY_SRC_invoicefrom").val())
}
break;
}
case "FROM PERIOD":
case "TO PERIOD":
case "INVOICE DATE":
{
if(BDLY_SRC_finalerrr[0].match("[SDATE]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[0]);
}
if(BDLY_SRC_finalerrr[1].match("[SDATE]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_replaceerrmsg(BDLY_SRC_finalerrr[1]);
}
break;
}
case "COMMENTS":
{
if(BDLY_SRC_finalerrr[0].match("[COMTS]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[COMTS]",$("#BDLY_SRC_comments").val())
}
if(BDLY_SRC_finalerrr[1].match("[COMTS]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[COMTS]",$("#BDLY_SRC_comments").val())
}
if($("#BDLY_SRC_lb_serachopt").val()==143){
if(BDLY_SRC_finalerrr[0].match("[DESC]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[DESC]",$("#BDLY_SRC_comments").val())
}
if(BDLY_SRC_finalerrr[1].match("[DESC]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[DESC]",$("#BDLY_SRC_comments").val())
}}
break;
}
case "SERVICED BY":
{
if(BDLY_SRC_finalerrr[0].match("[AB]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[AB]",$("#BDLY_SRC_lb_serviceby").val())
}
if(BDLY_SRC_finalerrr[1].match("[AB]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[AB]",$("#BDLY_SRC_lb_serviceby").val())
}
break;
}
case "SERVICE DUE":
{
if(BDLY_SRC_finalerrr[0].match("[MONTH]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[MONTH]",$("#BDLY_SRC_servicedue").val())
}
if(BDLY_SRC_finalerrr[1].match("[MONTH]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[MONTH]",$("#BDLY_SRC_servicedue").val())
}
break;
}
case "CAR NO":
{
if(BDLY_SRC_finalerrr[0].match("[CAR NO]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[CAR NO]",$("#BDLY_SRC_lb_carno").val())
}
if(BDLY_SRC_finalerrr[1].match("[CAR NO]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[CAR NO]",$("#BDLY_SRC_lb_carno").val())
}
break;
}
case "INVOICE AMOUNT":
{
if(BDLY_SRC_finalerrr[0].match("[FAMT]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[FAMT]",$("#BDLY_SRC_tb_fromamt").val())
BDLY_SRC_errormessagewitdata=BDLY_SRC_errormessagewitdata.replace("[TAMT]",$("#BDLY_SRC_tb_toamt").val())
}
if(BDLY_SRC_finalerrr[1].match("[FAMT]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[FAMT]",$("#BDLY_SRC_tb_fromamt").val())
BDLY_SRC_errormessagenodata=BDLY_SRC_errormessagenodata.replace("[TAMT]",$("#BDLY_SRC_tb_toamt").val())
}
break;
}
case "ACCOUNT NO":
{
if(BDLY_SRC_finalerrr[0].match("[ACCNO]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[ACCNO]",$("#BDLY_SRC_lb_accountno").val())
}
if(BDLY_SRC_finalerrr[1].match("[ACCNO]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[ACCNO]",$("#BDLY_SRC_lb_accountno").val())
}
break;
}
case "VOCIE NO":
{
if(BDLY_SRC_finalerrr[0].match("[DGTLVNO]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[DGTLVNO]",$("#BDLY_SRC_lb_Digvoiceno").val())
}
if(BDLY_SRC_finalerrr[1].match("[DGTLVNO]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[DGTLVNO]",$("#BDLY_SRC_lb_Digvoiceno").val())
}
break;
}
case "INVOICE TO":
{
if(BDLY_SRC_finalerrr[0].match("[INVETO]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[INVETO]",$('#BDLY_SRC_lb_invoiceto').find('option:selected').text())
}
if(BDLY_SRC_finalerrr[1].match("[INVETO]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[INVETO]",$('#BDLY_SRC_lb_invoiceto').find('option:selected').text())
}
break;
}
case "UNIT NO":
{
if(BDLY_SRC_finalerrr[0].match("[UNIT NO]"))
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0].replace("[UNIT NO]",$('#BDLY_SRC_lb_unitno').find('option:selected').text())
}
if(BDLY_SRC_finalerrr[1].match("[UNIT NO]"))
{
BDLY_SRC_errormessagenodata=BDLY_SRC_finalerrr[1].replace("[UNIT NO]",$('#BDLY_SRC_lb_unitno').find('option:selected').text())
}
break;
}
}
if(selectedSearchopt==198)
{
BDLY_SRC_errormessagewitdata=BDLY_SRC_finalerrr[0];
BDLY_SRC_errormessagenodata="";
}
if(resultarray.length==2)
{
$("#BDLY_SRC_div_searchresult_head").text(BDLY_SRC_errormessagenodata).removeClass("srctitle").addClass("errormsg")
$('#BDLY_SRC_tb_DataTableId').hide();
$('#BDLY_SRC_btn_search').attr("disabled", "disabled")
}
else
{
$('#BDLY_SRC_tb_DataTableId').show();
$("#BDLY_SRC_div_searchresult_head").text(BDLY_SRC_errormessagewitdata).removeClass("errormsg").addClass("srctitle");
oTable= $('#BDLY_SRC_tb_DataTableId').dataTable({
"aaSorting": [],
"pageLength": 25,
"sPaginationType":"full_numbers",
        "aoColumnDefs" : [ 
               { "aTargets" : ["uk-date-column"] , "sType" : "uk_date"}, { "aTargets" : ["uk-timestp-column"] , "sType" : "uk_timestp"},{ "aTargets" : ["uk-forperiod-column"] , "sType" : "uk_forperiod"} ]
});}
if(BDLY_SRC_sucsval==1)
{
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_confirmmessages[0].replace('[TYPE]',$('#BDLY_SRC_lb_ExpenseList').find('option:selected').text()),position:{top:150,left:500}}}); 
}
if(BDLY_SRC_sucsval==2)
{
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_confirmmessages[1].replace('[TYPE]',$('#BDLY_SRC_lb_ExpenseList').find('option:selected').text()),position:{top:150,left:500}}}); 
}
$(".preloader").fadeOut(500);
}
/*-------------------------------------------------FUNCTION TO VALIDATE UPDATE BUTTON------------------------------------*/
$(document).on('change blur','.required,.textarea,.hrs',function() {
var selectedSearchopt=$("#BDLY_SRC_lb_serachopt").val(),
BDLY_SRC_selectedexptype=$("#BDLY_SRC_lb_ExpenseList").val(),
BDLY_SRC_updatebtnflag=1;
var BDLY_SRC_inputvalarray=[];
$('.required').each(function() {
$(this).removeClass('invalid');
if(BDLY_SRC_purchasecard==0)
$('.tb_access_card').addClass('invalid');
if(($(this).hasClass('listbox'))&&($(this).val()!=23)){
BDLY_SRC_purchasecard=1}
var inputval=$(this).val();
BDLY_SRC_inputvalarray.push(inputval)
if(BDLY_SRC_selectedexptype==11)
{
if($(this).hasClass('hrs'))
{
var BDLY_SRC_duration=$(this).val().split('.');
var BDLY_SRC_durhrs=parseInt(BDLY_SRC_duration[0])
var BDLY_SRC_durmin=parseInt(BDLY_SRC_duration[1])
if(( BDLY_SRC_durhrs<24) || (BDLY_SRC_durhrs=='')|| (BDLY_SRC_durhrs==undefined)){
$('#BDLY_SCR_lbl_err_durationhrs').html('')
if((BDLY_SRC_durmin<60) || (BDLY_SRC_durmin=='')|| (BDLY_SRC_durmin==undefined)|| (BDLY_SRC_durmin==00)|| isNaN(BDLY_SRC_durmin)|| (BDLY_SRC_durmin==0)|| (BDLY_SRC_durmin=='00'))
$('#BDLY_SCR_lbl_err_durationmin').html('')
else{
BDLY_SRC_updatebtnflag=0;
$('.hrs').addClass('invalid')
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_finalerrr[4],position:{top:150,left:500}}});
}}
else if((BDLY_SRC_durhrs>24)||(BDLY_SRC_durhrs==24 && BDLY_SRC_durmin!=0 && BDLY_SRC_durmin<60)){
BDLY_SRC_updatebtnflag=0;
$('.hrs').addClass('invalid');
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_finalerrr[3],position:{top:150,left:500}}});
}}}
if(selectedSearchopt==198)
{
if(parseInt(inputval)==0&&parseInt(inputval)=="")
{BDLY_SRC_updatebtnflag=0;}
if((inputval!=""&&(inputval).toString().length<4&&parseInt(inputval)!=0))
{
BDLY_SRC_updatebtnflag=0;
$(this).addClass('invalid');
//CHECK UNIT NO LENGTH==4
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_finalerrr[1],position:{top:150,left:500}}}); 
}
else if((inputval!=""&&(inputval).toString().length==4&&parseInt(inputval)!=0)&&BDLY_SCR_DT_currentfield_hkp_unitno!=inputval)
{
$(".preloader").show();
var  newPos= adjustPosition($(this).position(),100,420);
resetPreloader(newPos);
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_check_access_cardOrUnitnoresult).BDLY_SRC_check_access_cardOrUnitno(inputval,BDLY_SRC_selectedexptype);
}
}
if((inputval.toString()=="")||(parseInt(inputval)==0 && BDLY_SRC_selectedexptype!=11)||(parseFloat(inputval)==0 ))
{
BDLY_SRC_updatebtnflag=0;
}});
if(BDLY_SRC_selectedexptype==6)
{
var BDLY_SRC_cardlenerr;
var BDLY_SCR_DT_access_card=BDLY_SRC_inputvalarray[0];
if(parseInt(BDLY_SCR_DT_access_card)==0&&parseInt(BDLY_SCR_DT_access_card)=="")
{BDLY_SRC_updatebtnflag=0;}
if($(this).hasClass('tb_access_card'))
{
//CHECK CARD NO LESS THAN 4 DIGITS
if(selectedSearchopt==175||selectedSearchopt==191){BDLY_SRC_cardlenerr=BDLY_SRC_finalerrr[4];
}
else{BDLY_SRC_cardlenerr=BDLY_SRC_finalerrr[3]}
if(selectedSearchopt==175||selectedSearchopt==191){BDLY_SRC_cardlenerr=BDLY_SRC_finalerrr[3]}else{BDLY_SRC_cardlenerr=BDLY_SRC_finalerrr[3]}
if((BDLY_SCR_DT_access_card!=""&&(BDLY_SCR_DT_access_card).toString().length<4&&parseInt(BDLY_SCR_DT_access_card)!=0))
{
BDLY_SRC_purchasecard=0;
$(this).addClass('invalid');
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_cardlenerr,position:{top:150,left:500}}}); 
}
else if(BDLY_SCR_DT_currentfield_access_card!=BDLY_SCR_DT_access_card)
{
if(BDLY_SCR_DT_access_card!='' && (BDLY_SCR_DT_access_card!=""&&(BDLY_SCR_DT_access_card).toString().length>=4&&parseInt(BDLY_SCR_DT_access_card)!=0)){
$(".preloader").show();
var  newPos= adjustPosition($(this).position(),100,350);
resetPreloader(newPos);
BDLY_SRC_purchasecard=1;
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_check_access_cardOrUnitnoresult).BDLY_SRC_check_access_cardOrUnitno(BDLY_SCR_DT_access_card,BDLY_SRC_selectedexptype);
}
}
else{
BDLY_SRC_purchasecard=1;}
}
}
/*---------------------------------------------------FUNCTION TO CHECK CARD OR UNIT NO EXISTS OR NOT---------------------------*/
function BDLY_SRC_check_access_cardOrUnitnoresult(response){
var selectedSearchopt=$("#BDLY_SRC_lb_serachopt").val(),
BDLY_SRC_selectedexptype=$("#BDLY_SRC_lb_ExpenseList").val()
$(".preloader").fadeOut(500);
var BDLY_SRC_cardalexistserr;
if(response==true)
{
$(".clsupdatebtn").attr('disabled','disabled');
if(selectedSearchopt==191){BDLY_SRC_cardalexistserr=BDLY_SRC_finalerrr[4];}
else{BDLY_SRC_cardalexistserr=BDLY_SRC_finalerrr[4]}
if(BDLY_SRC_selectedexptype==6)
{BDLY_SRC_purchasecard=0;
//CHECK CARD NO EXISTS OR NOT
$('.tb_access_card').addClass('invalid');
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_cardalexistserr,position:{top:150,left:500}}}); 
}
else
{
//CHECK UNIT NO ALREADY EXISTS OR NOT
$('.unittextbox').addClass('invalid');
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_finalerrr[2],position:{top:150,left:500}}}); 
}
}
else if($('.tb_access_card').hasClass('invalid')){
BDLY_SRC_purchasecard=1;
$('.tb_access_card').removeClass('invalid');}
else if($('.unittextbox').hasClass('invalid'))
$('.unittextbox').removeClass('invalid');
}
if((BDLY_SRC_updatebtnflag==0)||(BDLY_SRC_purchasecard==0)){$(".clsupdatebtn").attr('disabled','disabled');}
else{$(".clsupdatebtn").removeAttr('disabled');}
});
/*------------------------------------------------DATE PICKER FUNCTION FOR DATA TABLE----------------------------*/
$(document).on('change','.unit_based_date',function(){
if(($("#BDLY_SRC_lb_ExpenseList").val()==1) || ($("#BDLY_SRC_lb_ExpenseList").val()==5)){
var smindate= new Date( Date.parse(FormTableDateFormat($(this).val())) ); 
smindate.setDate( smindate.getDate() );  
var smindate = smindate.toDateString(); 
smindate = new Date( Date.parse( smindate ) );
$(".edate").datepicker( "option", "maxDate",smindate);
$(".sdate").datepicker( "option", "maxDate",smindate);
}});
$(document).on('change','.sdate',function(){
var smindate= new Date( Date.parse(FormTableDateFormat($(this).val())) ); 
if($("#BDLY_SRC_lb_ExpenseList").val()==2){
  var BDLY_INPUT_smonth=smindate.getMonth()+3;  var BDLY_INPUT_syear=smindate.getFullYear();
  var BDLY_INPUT_startdate = new Date(BDLY_INPUT_syear,BDLY_INPUT_smonth);
  var enddate=new Date(BDLY_INPUT_startdate.getFullYear(),BDLY_INPUT_startdate.getMonth(),BDLY_INPUT_startdate.getDate()-1);
  var BDLY_SRC_sh_maxdate='';
var BIZDLY_SRC_enddate = new Date( Date.parse(BDLY_SRC_unitenddate) ); 
if(enddate>BIZDLY_SRC_enddate)
BDLY_SRC_sh_maxdate=BIZDLY_SRC_enddate;
else
BDLY_SRC_sh_maxdate=enddate;
$(".edate").datepicker( "option", "maxDate",BDLY_SRC_sh_maxdate); 
}
smindate.setDate( smindate.getDate() );  
var smindate = smindate.toDateString(); 
smindate = new Date( Date.parse( smindate ) );
$(".edate").datepicker( "option", "minDate",smindate);
});
/*------------------------------------------------TO DELETE EACH ROW FROM TABLE----------------------------*/
$(document).on('click','.delete',function() {
var selectedSearchopt=$("#BDLY_SRC_lb_serachopt").val()
var BDLY_SRC_selectedexptype=$("#BDLY_SRC_lb_ExpenseList").val()
if($(this).val()=='Cancel'){
if(BDLY_SRC_selectedexptype==10||selectedSearchopt==198)
{
$(this).val('Delete').css('display','none');
}
else
{
$(this).val('Delete').show();
}
$(this).prev().val('Edit').addClass('edit').removeClass('update').removeClass("clsupdatebtn").removeAttr('disabled');
var td =  $(this).closest("tr").children("td");
$(td).each(function () {
if($(this).index()<td.length-3){
$(this).html($(this).data('restore'));
}
});
$('.edit').removeAttr("disabled").next().removeAttr("disabled");
}
else{
var td =  $(this).closest("tr").children("td");
var totallenght =td.length;
BDLY_DT_row_old_vals=[];
$(td).each(function () {
var tdid =$(this).index();
var html = $(this).html();
if(tdid<totallenght-2)
BDLY_DT_row_old_vals.push(html)
});
$('.edit').removeAttr("disabled").next().removeAttr("disabled");
var dbrowid=$(this).closest("tr").children("td:first").html();
BDLY_SRC_DeleteKey=dbrowid;
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_confirmmessages[4],confirmation:true,position:{top:500,left:2080}}}); 
BDLY_SRC_CurrentTR=$(this).closest("tr");
}
});
/*------------------------------------------------TO DELETE EACH ROW FROM TABLE AFTER CONFIRMATION----------------------------*/
$(document).on('click','.messageconfirm',function(){
$(".preloader").show();
var  newPos= adjustPosition($(this).position(),100,230);
resetPreloader(newPos);
var selectedexpense=$('#BDLY_SRC_lb_ExpenseList').val();
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_DT_success_deleterow).BDLY_SRC_DeleteRowData(BDLY_SRC_DeleteKey,selectedexpense);
});
function BDLY_SRC_DT_success_deleterow(BDLY_SRC_chkdelflag){
BDLY_SRC_sucsval=2;
if(BDLY_SRC_chkdelflag==1)
{
var selectedSearchopt=$("#BDLY_SRC_lb_serachopt").val(),
BDLY_SRC_selectedexptype=$("#BDLY_SRC_lb_ExpenseList").val(),
BDLY_SRC_getsearch_optiontypeval=BDLY_SRC_getsearch_optiontype(selectedSearchopt);
//CHK SEARCH OPTION TYPE
if(BDLY_SRC_getsearch_optiontypeval=="COMMENTS"||
BDLY_SRC_getsearch_optiontypeval=="CAR NO"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE ITEMS"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE FROM"||
BDLY_SRC_getsearch_optiontypeval=="UNIT NO"||
BDLY_SRC_getsearch_optiontypeval=="CARD NO"||
BDLY_SRC_getsearch_optiontypeval=="CLEANER NAME"||
BDLY_SRC_getsearch_optiontypeval=="ACCOUNT NO"||
BDLY_SRC_getsearch_optiontypeval=="VOCIE NO"||
BDLY_SRC_getsearch_optiontypeval=="SERVICED BY"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE TO"||
BDLY_SRC_getsearch_optiontypeval=="CATEGORY"
)
{
if(BDLY_SRC_sucsval==2)
{
$("#BDLY_SRC_div_searchresult,#BDLY_SRC_div_searchresult_head,#BDLY_SRC_nodyndataerr").html('');
$(".preloader").fadeOut(500);
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_confirmmessages[1].replace('[TYPE]',$('#BDLY_SRC_lb_ExpenseList').find('option:selected').text()),position:{top:150,left:500}}}); 
}
}
else
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_UpdateDataTable).BDLY_SRC_getAnyTypeExpData(document.getElementById('BDLY_SRC_form'));
}
}
else
{
$(".preloader").fadeOut(500);
var BDLY_SRC_err_deletion=BDLY_SRC_confirmmessages[2];
if($('#BDLY_SRC_lb_ExpenseList').val()==6)
BDLY_SRC_err_deletion=BDLY_SRC_confirmmessages[25];
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_err_deletion,position:{top:150,left:500}}}); 
}
}
$(document).on('click','.required,.invalid',function() {
$(this).css({ backgroundColor:'white' });
});
/*------------------------------VALIDATE FOR SDATE,EDATE AND INV DATE-----------------------------*/
function BIZDLY_SRC_func_date(){
BDLY_DT_flg_date=1;
var BIZDLY_SRC_invdate = new Date( Date.parse(BDLY_SRC_unitinvdate)  ); 
var BIZDLY_SRC_startdate = new Date( Date.parse(BDLY_SRC_unitstartdate) ); 
var BIZDLY_SRC_maxdate=new Date( Date.parse(BDLY_SRC_unitenddate)  ); 
if(($("#BDLY_SRC_lb_ExpenseList").val()==1) || ($("#BDLY_SRC_lb_ExpenseList").val()==5))
var BIZDLY_SRC_maxdate=new Date( Date.parse(BDLY_SRC_unitinvdate)  ); 
if((BDLY_SRC_unitinvdate!=null && new Date( Date.parse($( ".unit_based_date" ).datepicker('getDate')) ).setHours(0,0,0,0)>BIZDLY_SRC_invdate.setHours(0,0,0,0))
|| (BDLY_SRC_unitinvdate!=null && new Date( Date.parse($( ".unit_based_date" ).datepicker('getDate')) ).setHours(0,0,0,0)<BIZDLY_SRC_startdate.setHours(0,0,0,0))){
BDLY_DT_flg_date=0;
}
else if((BDLY_SRC_unitstartdate!=null && $('.sdate')!=undefined && new Date( Date.parse($(".sdate").parent().find('input').datepicker( 'getDate')) ).setHours(0,0,0,0)>BIZDLY_SRC_maxdate.setHours(0,0,0,0))
|| (BDLY_SRC_unitstartdate!=null && $('.sdate')!=undefined && new Date( Date.parse($(".sdate").parent().find('input').datepicker( 'getDate')) ).setHours(0,0,0,0)<BIZDLY_SRC_startdate.setHours(0,0,0,0))){
BDLY_DT_flg_date=0;
}
else if((BDLY_SRC_unitenddate!=null && $('.edate')!=undefined && new Date( Date.parse($(".edate").parent().find('input').datepicker( 'getDate')) ).setHours(0,0,0,0)>BIZDLY_SRC_maxdate.setHours(0,0,0,0))
|| (BDLY_SRC_unitenddate!=null && $('.edate')!=undefined && new Date( Date.parse($(".edate").parent().find('input').datepicker( 'getDate')) ).setHours(0,0,0,0)<BIZDLY_SRC_startdate.setHours(0,0,0,0))){
BDLY_DT_flg_date=0;
}
if(BDLY_DT_flg_date==0){
BDLY_DT_func_oldposition();
}
else{
$(".unit_based_date").datepicker( "option", "maxDate",BIZDLY_SRC_invdate);
$(".unit_based_date").datepicker( "option", "minDate",BIZDLY_SRC_startdate);
$(".sdate").datepicker( "option", "minDate",BIZDLY_SRC_startdate);
if($("#BDLY_SRC_lb_ExpenseList").val()==1){
$(".sdate").datepicker( "option", "minDate",BIZDLY_SRC_startdate);
$(".unit_based_date").datepicker( "option", "minDate",BIZDLY_SRC_startdate);
}
if(($("#BDLY_SRC_lb_ExpenseList").val()==1) || ($("#BDLY_SRC_lb_ExpenseList").val()==5)){
//FROM DATE
var CEXTN_db_chkindate1 = new Date( Date.parse($( ".unit_based_date" ).datepicker('getDate')) ); 
CEXTN_db_chkindate1.setDate( CEXTN_db_chkindate1.getDate() );  
var CEXTN_db_chkindate1 = CEXTN_db_chkindate1.toDateString(); 
CEXTN_db_chkindate1 = new Date( Date.parse( CEXTN_db_chkindate1 ) );
$(".sdate").datepicker( "option", "maxDate",CEXTN_db_chkindate1);
$(".edate").datepicker( "option", "maxDate",CEXTN_db_chkindate1);
}
else{
var BIZDLY_SRC_enddate = new Date( Date.parse(BDLY_SRC_unitenddate) ); 
$(".sdate").datepicker( "option", "maxDate",BIZDLY_SRC_enddate);
if($("#BDLY_SRC_lb_ExpenseList").val()==2){
var CEXTN_db_sdate = new Date( Date.parse($(".sdate").parent().find('input').datepicker( 'getDate')) );
var BDLY_INPUT_smonth=CEXTN_db_sdate.getMonth()+3;  var BDLY_INPUT_syear=CEXTN_db_sdate.getFullYear();
var BDLY_INPUT_startdate = new Date(BDLY_INPUT_syear,BDLY_INPUT_smonth);
var enddate=new Date(BDLY_INPUT_startdate.getFullYear(),BDLY_INPUT_startdate.getMonth(),BDLY_INPUT_startdate.getDate()-1)
var BDLY_SRC_sh_maxdate='';
if(enddate>BIZDLY_SRC_maxdate)
BDLY_SRC_sh_maxdate=BIZDLY_SRC_maxdate;
else
BDLY_SRC_sh_maxdate=enddate;
$(".edate").datepicker( "option", "maxDate",BDLY_SRC_sh_maxdate); 
}else
$(".edate").datepicker( "option", "maxDate",BIZDLY_SRC_enddate);
}
var CEXTN_db_sdate = new Date( Date.parse($(".sdate").parent().find('input').datepicker( 'getDate')) );
$(".edate").datepicker( "option", "minDate",CEXTN_db_sdate);
}
}
/*------------------------------SUCCESS FUNCTION FOR EILIB DATE FUNCTION-------------------------------*/
function BDLY_SRC_succ_Unitdate(BDLY_SRC_res_Unitdate){
BDLY_SRC_unitstartdate=BDLY_SRC_res_Unitdate.unitsdate;
BDLY_SRC_unitenddate=BDLY_SRC_res_Unitdate.unitedate;
BDLY_SRC_unitinvdate=BDLY_SRC_res_Unitdate.invdate;
$(".preloader").fadeOut(500);
if(BDLY_DT_flg_date!=0)
BIZDLY_SRC_func_date();
}
/*----------------------------------COMMON FUNCTION FOR CHECKING DATE WITH IN UNIT VALIDATION PERIOD---------*/
function BDLY_DT_func_oldposition(){
//SHOWING ERR MSG IF WE HAVE WRONG DATE
if(BDLY_DT_flg_date==0){
var BDLY_SRC_sdate_err_tostring=BDLY_SRC_confirmmessages[6].toString();
var BDLY_SRC_sdate=BDLY_SRC_sdate_err_tostring.replace("[SD]",FormTableDateFormat(BDLY_SRC_unitstartdate));
var BDLY_SRC_date_err=BDLY_SRC_sdate.replace("[ED]", FormTableDateFormat(BDLY_SRC_unitinvdate))
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_date_err,position:{top:150,left:500}}});
var td =$('.update').closest("tr").children("td");
$(td).each(function () {
if($(this).index()<td.length-3){
$(this).html($(this).data('restore'));
}});
$('.update').val('Edit').addClass('edit').removeClass('update').removeClass("clsupdatebtn").removeAttr('disabled').next().show().val('Delete');
$('.edit').removeAttr("disabled").next().removeAttr("disabled");
}
else{
$(this).next().show().val('Cancel');
$('.edit').attr("disabled", "disabled").next().attr("disabled", "disabled");
oTable.fnUpdate(record, 1);}
}
/*-----------------------------------ACTON TO EDIT EACH ROW IN DATA TABLE---------------------*/
$(document).on('click','.edit',function() {
var  newPos= adjustPosition($(this).position(),100,-190);
resetPreloader(newPos);
$(".preloader").show();
var BDLY_DT_wrongendate='';
var tr = $(this).closest("tr").index()+1;
var td =  $(this).closest("tr").children("td");
var tdcount = td.index()+1;
var totallenght =td.length;
$(this).val('Update').addClass('update').removeClass('edit').addClass("clsupdatebtn").attr('disabled','disabled');
BDLY_DT_row_old_vals=[];
var BDLY_DT_row_old_vals1=[];
BDLY_DT_flg_date=1;
$(td).each(function () {
var tdid =$(this).index();
var thtext = $("#BDLY_SRC_tb_DataTableId tr:eq(0) th:eq("+tdid+")").attr('class').split(" ")[0];
var requiredindex=$("#BDLY_SRC_tb_DataTableId tr:eq(0) th:eq("+tdid+")").html().search("\\*");
BDLY_DT_row_old_vals1.push($(this).text())
var html = $(this).html();
$(this).data("restore",html);
if(tdid<totallenght-1)
BDLY_DT_row_old_vals.push(html)
var dateindex=thtext.search("date");
if(dateindex!=-1){
BDLY_DT_currentunit= $(this).parent().find('td.unitno').html();
if(thtext=='date')
var input = $('<input type="text" class="unit_based_date datepickerbox datemandtry"/>');
if(thtext=='ndate')
var input = $('<input type="text" class="ndate datepickerbox datemandtry" />');
if(thtext=='sdate')
var input = $('<input type="text" class="sdate datepickerbox datemandtry" />');
if(thtext=='edate')
var input = $('<input type="text" required class="edate datepickerbox datemandtry" />');
input.val(html);
$(this).html(input); 
var BIZDLY_SRC_migdate=html;
var BIZDLY_SRC_migdate = new Date( Date.parse( FormTableDateFormat(html)) ); 
if(thtext=='ndate'){
if(BIZDLY_SRC_migdate>new Date()){
BDLY_DT_flg_date=0;BDLY_DT_func_oldposition();}
else
$(".ndate").datepicker({dateFormat: "dd-mm-yy",changeMonth: true,changeYear:true,maxDate:new Date()});
}
if((thtext=='date')||(thtext=='edate')||(thtext=='sdate')){
$(".datepickerbox").datepicker({dateFormat: "dd-mm-yy",changeMonth: true,changeYear:true});
}
if(requiredindex!=-1)
$(this).find('input').addClass('required').addClass('prevent');
}
else if(thtext=='unittextbox')
{
BDLY_SCR_DT_currentfield_hkp_unitno=html;
var input = $('<input type="text" required class="unittextbox" maxlength="4"  size="4" />');
input.val(BDLY_DT_row_old_vals1[(BDLY_DT_row_old_vals1.length)-1]);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
else if(thtext=='textbox')
{
var input = $('<input type="text"  class="textbox autocom" maxlength="200"/>');
var tbinputlen=((BDLY_DT_row_old_vals1[(BDLY_DT_row_old_vals1.length)-1]).toString().length)+3;
var input = $('<input type="text"  class="textbox autocom" maxlength="200"  size='+tbinputlen+' />');
input.val(BDLY_DT_row_old_vals1[(BDLY_DT_row_old_vals1.length)-1]);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
else if (thtext=='textarea' ){
var tbinputlen=(BDLY_DT_row_old_vals1[(BDLY_DT_row_old_vals1.length)-1]).toString().length;
var  input = $('<textarea class="textarea" ></textarea>');
input.val(BDLY_DT_row_old_vals1[(BDLY_DT_row_old_vals1.length)-1]);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('textarea').addClass('required');
}
else if(thtext=='amount'){
var  input = $('<input type="text"  class="amount BDLY_SRC_nums"  />');
input.val(html);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
$(".BDLY_SRC_nums").prop("title",BDLY_SRC_confirmmessages[5]);
}
else if(thtext=='optionalamnt1'){
var  input = $('<input type="text"  id="optionalamnt1" class="amount"  />');
input.val(html);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
else if(thtext=='optionalamnt2'){
var  input = $('<input type="text"  id="optionalamnt2" class="amount"  />');
input.val(html);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
else if(thtext=='optionalamnt3'){
var  input = $('<input type="text"  id="optionalamnt3" class="amount"  />');
input.val(html);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
else if(thtext=='duration'){
var  input = $('<input type="text" class="hrs"/>');
input.val(html);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
else if(thtext=='month'){
var  input = $('<input type="text" class="BDLY_SCR_forperiod datemandtry"/>');
input.val(html);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
$('.BDLY_SCR_forperiod').datepicker( {changeMonth: true,  changeYear: true,  showButtonPanel: true,  dateFormat: 'MM-yy', maxDate:new Date(),   
onClose: function(dateText, inst) {
var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
$(this).datepicker('setDate', new Date(year, month, 1));
$(this).blur();
} });
$(".BDLY_SCR_forperiod").focus(function () {
$(".ui-datepicker-calendar").hide();
$("#ui-datepicker-div").position({ my: "left top", at: "left bottom", of: $(this)});});
}
else if(thtext=='access_card'){
BDLY_SCR_DT_currentfield_access_card=html;
var  input = $('<input type="text" class="tb_access_card"/>');
input.val(html);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
else if(thtext=='hfp_unit_lb'){
var  input = $('<select id="DT_hkp_unit_lb" class="listbox required" value="" ></select>');
input.val(html);
var options='';
for (var i = 0; i <BDLY_SRC_HKunitnovalues.length; i++) {
if(BDLY_SRC_HKunitnovalues[i].value==html){
options +='<option value="'+BDLY_SRC_HKunitnovalues[i].value +'" selected>' + BDLY_SRC_HKunitnovalues[i].value + '</option>';
}else
options +='<option value="'+BDLY_SRC_HKunitnovalues[i].value +'">' + BDLY_SRC_HKunitnovalues[i].value + '</option>';
}
input.html(options);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
else if(thtext=='unit_category_lb'){
var  input = $('<select id="DT_unit_category_lb" class="listbox required" value=""></select>');
input.val(html);
for (var i = 0; i <BDLY_SRC_unitcategoryvalue.length; i++) {
if(BDLY_SRC_unitcategoryvalue[i].value==html)
{
var BDLY_SRC_lb_category=BDLY_SRC_unitcategoryvalue[i].key;
}
if(BDLY_SRC_unitcategoryvalue[i].key==192)continue;
if(BDLY_SRC_unitcategoryvalue[i].value==html){
options +='<option value="'+BDLY_SRC_unitcategoryvalue[i].key +'" selected>' + BDLY_SRC_unitcategoryvalue[i].value + '</option>';
}else
{
options +='<option value="'+BDLY_SRC_unitcategoryvalue[i].key +'">' + BDLY_SRC_unitcategoryvalue[i].value + '</option>';
}
}
input.html(options);
$(this).html(input);
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
else if(thtext=='cus_name_lb'){
var BDLY_SRC_lb_cusname=$("#BDLY_SRC_lb_cusname").val();
if(html!=""){
var BDLY_DT_getunit_no =BDLY_DT_row_old_vals1[1];
var  input = $('<select id="DT_unitexp_cus_name_lb" class="listbox required"></select>');
var options;
if(BDLY_SRC_lb_cusname==undefined)
BDLY_SRC_unit_custname=html;
else
BDLY_SRC_unit_custname=BDLY_SRC_lb_cusname;
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_DT_success_cusname).BDLY_SRC_get_cusname(BDLY_DT_getunit_no);
input.html(options);
$(this).html(input);
}
if(requiredindex!=-1)
$(this).find('input').addClass('required');
}
var selectedexpense=$('#BDLY_SRC_lb_ExpenseList').val();
var selectedSearchopt=$('#BDLY_SRC_lb_serachopt').val();
if(selectedexpense==11)
{
$(".hrs").doValidation({rule:'numbersonly',prop:{realpart:2,imaginary:2}}).width(40);
}
else if((selectedexpense==1)||(selectedexpense==2)||(selectedexpense==5))
{
var BDLY_SRC_amtrealpart=3;
if(selectedexpense==2)
BDLY_SRC_amtrealpart=4;
$(".amount").doValidation({rule:'numbersonly',prop:{integer:true,realpart:BDLY_SRC_amtrealpart,imaginary:2}}).width(55);
}
else if(selectedexpense==10)
{
$(".amount").doValidation({rule:'numbersonly',prop:{realpart:4,imaginary:2}}).width(50);
}
else{
var realpart =((selectedexpense==3)?5:3);
var width =((realpart==3)?40:60);
$(".amount").doValidation({rule:'numbersonly',prop:{realpart:realpart,imaginary:2}}).width(width);
}
if(selectedexpense==3)
{
$(".textbox").doValidation({rule:'general',prop:{autosize:true}});//unit exp invoice from autosize textbox
}
if(($('#BDLY_SRC_lb_ExpenseList').val()==10)||($('#BDLY_SRC_lb_ExpenseList').val()==11)||($('#BDLY_SRC_lb_ExpenseList').val()==12))
{
$(".preloader").fadeOut(500);
}
$(".unittextbox").doValidation({rule:'numbersonly',prop:{realpart:4,leadzero:true}});
$(".tb_access_card").doValidation({rule:'numbersonly',prop:{realpart:7}}).width(60);
});
$(this).next().show().val('Cancel');
$('.edit').attr("disabled", "disabled").next().attr("disabled", "disabled");
var td =  $(this).closest("tr").children("td");
$(td).each(function () {
var tdid =$(this).index();
var thtext = $("#BDLY_SRC_tb_DataTableId tr:eq(0) th:eq("+tdid+")").attr('class').split(" ")[0];
if((thtext=='unit')&&($('#BDLY_SRC_lb_ExpenseList').val()!=11)&&($('#BDLY_SRC_lb_ExpenseList').val()!=12)){
BDLY_SRC_unitenddate=null,
BDLY_SRC_unitstartdate=null,
BDLY_SRC_unitinvdate=null;
$(".preloader").show();
//var  newPos= adjustPosition($(this).position(),100,230);
//resetPreloader(newPos);
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_succ_Unitdate).BDLY_SRC_getUnitDate($(this).html());}
});
if($('#BDLY_SRC_lb_ExpenseList').val()==3)
auto();
});
function auto(){
highlightSearchText();
$('.autocom').autocomplete({
source: BDLY_SRC_arr_unitcmts,
select:AutoCompleteSelectHandler
});
}
//FUNCTION TO VALIDATE AMOUNT TEXT BOX HAVING MORE THAN ONE AMT FOR ELECTRICITY,FACILITY USE
$(document).on('keypress keydown','#optionalamnt1,#optionalamnt2,#optionalamnt3',function() {
if($(this).attr('id')=='optionalamnt1'){
$(this).addClass('required');
$('#optionalamnt2').val('').removeClass('required');
if($('#optionalamnt3').length)
$('#optionalamnt3').val('').removeClass('required');
}
else if($(this).attr('id')=='optionalamnt2') {
$(this).addClass('required');
$('#optionalamnt1').val('').removeClass('required');
if($('#optionalamnt3').length)
$('#optionalamnt3').val('').removeClass('required');
}
else if($(this).attr('id')=='optionalamnt3') {
$(this).addClass('required');
$('#optionalamnt1').val('').removeClass('required');
$('#optionalamnt2').val('').removeClass('required');
}
});
/*---------------------------------------------------ACTION ON UNIT EXPENSE CATEGORY CHANGE --------------------*/
$(document).on('change','#DT_unit_category_lb',function() {
var BDLY_DT_unit_category_lb=$(this).val();
$(this).parent().next().html('');
if(BDLY_DT_unit_category_lb==23){
var BDLY_DT_getunit_no =$(this).parent().parent().find('td.unitno').html();
var  input = $('<select id="DT_unitexp_cus_name_lb" class="listbox"></select>');
$(".preloader").show();
var  newPos= adjustPosition($(this).position(),100,230);
resetPreloader(newPos);
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_DT_success_cusname).BDLY_SRC_get_cusname(BDLY_DT_getunit_no);
$(this).parent().next().html(input);
}
});
/*---------------------------------------------------BIND CUSTOMER NAME IN LIST BOX--------------------*/
function BDLY_SRC_DT_success_cusname(response){
Unit_Exp_Cusname_global=response;
var options;
if(Unit_Exp_Cusname_global.length==0){
BDLY_SRC_purchasecard=0;
$('#DT_unitexp_cus_name_lb').hide().removeClass('required');
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_confirmmessages[26],position:{top:150,left:500}}}); }
else{
BDLY_SRC_purchasecard=1;
for (var i = 0; i <Unit_Exp_Cusname_global.length; i++) {
var firstname_lastname =Unit_Exp_Cusname_global[i].value;
if($("#BDLY_SRC_lb_cusname").val()==undefined)
var Unit_Exp_Cusname_srch=Unit_Exp_Cusname_global[i].value;
else
var Unit_Exp_Cusname_srch=Unit_Exp_Cusname_global[i].key;
if(Unit_Exp_Cusname_srch==BDLY_SRC_unit_custname)
options +='<option value="'+Unit_Exp_Cusname_global[i].key +'" selected>' +firstname_lastname+ '</option>';
else
options +='<option value="'+Unit_Exp_Cusname_global[i].key +'">' +firstname_lastname+ '</option>';
}
$('#DT_unitexp_cus_name_lb').html(options).show().addClass('required');
}
if(BDLY_SRC_unitenddate!=null && BDLY_SRC_unitenddate!='null' )
$(".preloader").fadeOut(500);
}
$(document).on('focus','#DT_unitexp_cus_name_lb, #DT_unit_category_lb',function() {
if($(this).attr('id')=='DT_unitexp_cus_name_lb')
$("#DT_unitexp_cus_name_lb option[value='']").remove();
else
$("#DT_unit_category_lb option[value='']").remove();
});
/*--------------------------------------------------update each row in database--------------------*/
$(document).on('click','.update',function() {
var allGood = true;
$( ".autocom" ).autocomplete( "destroy" );
$('.ui-autocomplete-input').removeClass('ui-autocomplete-input').removeClass("autocom");
var requiredtd =  $(this).closest("tr").children("td").find(".required");
requiredtd.each(function(){
var val =$.trim($(this).val());
if(val == "" || val == 0 || $(this).hasClass('invalid') ) {
$(this).animate({'backgroundColor' : '#F8E2CE'});
$(this).animate({'backgroundColor' : '#FFFFCC'}, 100);
allGood = false;
} });
if(allGood==false)
return false;
$(".preloader").show();
var  newPos= adjustPosition($(this).position(),100,-190);
resetPreloader(newPos);
BDLY_DT_row_new_vals=[];
var td =  $(this).closest("tr").children("td");
var BDLY_SRC_selectedexptype=$("#BDLY_SRC_lb_ExpenseList").val()
var selectedSearchopt=$("#BDLY_SRC_lb_serachopt").val();
var totallenght= td.length;
$(td).each(function () {
var tdid =$(this).index();
if(tdid==0)
BDLY_DT_row_new_vals.push($(this).html())
if(tdid>0 && tdid<totallenght-3){
var oldinput= $(this).children();
if(oldinput.length){
BDLY_DT_row_new_vals.push(oldinput.val())}
else {BDLY_DT_row_new_vals.push($(this).html());
}
if(oldinput.hasClass('listbox'))
var val =oldinput.find('option:selected').text();
else var val =oldinput.val();
}
});
//CALL FUNCTION TO UPDATE RECORD IN DB
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_UpdaterowData_result).BDLY_SRC_UpdaterowData(BDLY_DT_row_new_vals,BDLY_DT_row_old_vals,$("#BDLY_SRC_lb_ExpenseList").val(),selectedSearchopt);
//SUCCESS FUNCTION TO UPDATE DATA TABLE N TO SHOW CONFIRMATION MESSAGE
function BDLY_SRC_UpdaterowData_result(BDLY_successflag){
var selectedSearchopt=$("#BDLY_SRC_lb_serachopt").val()
if(BDLY_successflag==1)
{
if(BDLY_SRC_selectedexptype==10||selectedSearchopt==198)
{
$(this).val('Edit').addClass("edit").addClass("Currentbtn").removeClass("update").next().css('display','none').val('Delete');
}
else
{
$(this).val('Edit').addClass("edit").addClass("Currentbtn").removeClass("update").next().val('Delete').show();
}
$(".Currentbtn").removeClass("Currentbtn");
$(".edit").removeAttr("disabled").next().removeAttr("disabled");
BDLY_SRC_sucsval=1;
var selectedSearchopt=$("#BDLY_SRC_lb_serachopt").val(),
BDLY_SRC_selectedexptype=$("#BDLY_SRC_lb_ExpenseList").val(),
BDLY_SRC_getsearch_optiontypeval=BDLY_SRC_getsearch_optiontype(selectedSearchopt);
//CHK SEARCH OPTION TYPE
if(BDLY_SRC_getsearch_optiontypeval=="COMMENTS"||
BDLY_SRC_getsearch_optiontypeval=="CAR NO"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE ITEMS"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE FROM"||
BDLY_SRC_getsearch_optiontypeval=="UNIT NO"||
BDLY_SRC_getsearch_optiontypeval=="CARD NO"||
BDLY_SRC_getsearch_optiontypeval=="CLEANER NAME"||
BDLY_SRC_getsearch_optiontypeval=="ACCOUNT NO"||
BDLY_SRC_getsearch_optiontypeval=="VOCIE NO"||
BDLY_SRC_getsearch_optiontypeval=="SERVICED BY"||
BDLY_SRC_getsearch_optiontypeval=="INVOICE TO"||
BDLY_SRC_getsearch_optiontypeval=="CATEGORY"
)
{
$("#BDLY_SRC_div_searchresult,#BDLY_SRC_div_searchresult_head,#BDLY_SRC_nodyndataerr").html('');
if(BDLY_SRC_sucsval==1)
{
$(".preloader").fadeOut(500);
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_SRC_confirmmessages[0].replace('[TYPE]',$('#BDLY_SRC_lb_ExpenseList').find('option:selected').text()),position:{top:150,left:500}}}); 
}
}
else
{
google.script.run.withFailureHandler(onFailure).withSuccessHandler(BDLY_SRC_UpdateDataTable).BDLY_SRC_getAnyTypeExpData(document.getElementById('BDLY_SRC_form'));
}
}
else
{
$(".preloader").fadeOut(500);
if(BDLY_successflag==0)
var BDLY_successflag=BDLY_SRC_confirmmessages[3];
$(document).doValidation({rule:'messagebox',prop:{msgtitle:"BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE",msgcontent:BDLY_successflag,position:{top:150,left:500}}}); 
}
}
});
});
</script>
</head>
<body>
<div class="wrapper">
<div  class="preloader MaskPanel"><div class="preloader statusarea" ><div style="padding-top:90px; text-align:center"><img src="https://googledrive.com/host/0B5pkfK_IBDxjU1FrR3hVTXB4a28/Loading.gif"/></div></div></div>
<div class="title" id="fhead" ><div style="padding-left:500px; text-align:left;"><p><h3>BIZ EXPENSE DAILY:SEARCH/UPDATE/DELETE</h3><p></div></div>
<form class="content" id="BDLY_SRC_form">
<table id="BDLY_SRC_tble_maintable">
<tr><td class="td_label" >TYPE OF EXPENSE</td><td><select id="BDLY_SRC_lb_ExpenseList" name="BDLY_SRC_lb_ExpenseList" ><option value="" >SELECT</option></select></td></tr>
<tr id="BDLY_SRC_tr_serachopt" style="display:none"><td class="td_label">SEARCH BY</td><td class="BDLY_SRC_input_val"><select id="BDLY_SRC_lb_serachopt" name="BDLY_SRC_lb_serachopt" ><option value="" >SELECT</option></select></td></tr>
<tr><td class="srctitle" colspan="2" id="BDLY_SRC_Optionhead"></td></tr>
<tbody id="BDLY_SRC_dynamicarea" >
</tbody>
<tr><td></td>
<td style="width:200px" id="BDLY_SRC_td_for_searchbutton"><input type="button" name="BDLY_SRC_btn_search" id="BDLY_SRC_btn_search" class="btn" value="SEARCH" style="display:none" disabled /></td>
</tr>
<tr><td><label id="BDLY_SRC_lbl_errmsg_exp" class="errormsg"></label></td></tr>
</table>
<div id="BDLY_SRC_nodyndataerr" class="errormsg"></div>
<div class="srctitle" id="BDLY_SRC_div_searchresult_head"></div>
<table><tr><td><div id="BDLY_SRC_div_searchresult" ></div></td></tr></table>
</form>
</div> 
</body>
</html>